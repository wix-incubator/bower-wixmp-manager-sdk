define("src/utils/normalize-uri",[],function(){return function(e){if(typeof e!="string")throw new Error("URI is not a string");return e.replace(/([a-z\-_0-9]+)\/\//gi,"$1/")}}),define("src/utils/utils",[],function(){function e(e,t,n){var r;return n?(r=t.map(n),t[r.indexOf(Math[e].apply(null,r))]):Math[e].apply(this,t)}var t={extend:function(e){var t=Array.prototype.slice.call(arguments,1);return t.forEach(function(t){typeof t=="object"&&t!=null&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e},merge:function(){var e=Object.prototype.hasOwnProperty;return Array.prototype.reduce.call(arguments,function(t,n){return Object.keys(t).forEach(function(r){e.call(n,r)&&(t[r]=n[r])}),Object.keys(n).forEach(function(e){t[e]=n[e]}),t},{})},partial:function(e){var t=Array.prototype.slice.call(arguments,1);return function(){var n=Array.prototype.slice.call(arguments);return e.apply(this,t.concat(n))}},getParameterByName:function(e,t){var n,r;return t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(e),r?decodeURIComponent(r[1].replace(/\+/g," ")):""},snakeToCamel:function(e){return e.replace(/(\_[a-z])/g,function(e){return e.toUpperCase().replace("_","")})},find:function(e,t){var n;return e.some(function(e){if(t(e)===!0)return n=e,!0}),n},encodeParams:function(e){var t=[],n=function(e,n){t[t.length]=encodeURIComponent(e)+"="+encodeURIComponent(n)};return Object.keys(e).forEach(function(t){n(t,e[t])}),t.join("&").replace(/%20/g,"+")}};return t.min=t.partial(e,"min"),t.max=t.partial(e,"max"),t}),define("src/utils/http",["bluebird","./normalize-uri","./utils"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h;return h={withCredentials:!1,cache:!0,headers:{Accept:"application/json, text/plain, */*"}},e.prototype.progress=function(e){return this._progressCallback=e,this},e.prototype.notify=function(e){return typeof this._progressCallback=="function"&&this._progressCallback(e),this},c=function(t,r,i){var s=new e(function(e,r){t.addEventListener("error",function(){r(f(n.extend({},t,{statusText:"error"})))},!1),t.addEventListener("timeout",function(){r(f(n.extend({},t,{statusText:"timeout_has_exceeded"})))},!1),t.addEventListener("load",function(){/^2\d+/.test(t.status.toString())?e(f(t)):r(f(t))},!1)});return i&&(t.upload.onprogress=function(e){var t=Math.round(e.lengthComputable?e.loaded*100/e.total:0);s.notify(t)}),s.cancellable().catch(function(){t.abort()}),r(),s},f=function(e){return{status:e.status,statusText:e.statusText,data:l(e.responseText)}},l=function(e){return typeof e=="string"&&(["{","["].indexOf(e[0])>=0?e=JSON.parse(e):e={message:e}),e},a=function(e,t){if(!t)return e;var n=[];return Object.keys(t).forEach(function(e){var r=t[e];if(r===null||typeof r=="undefined")return;r instanceof Array||(r=[r]),r.forEach(function(t){t instanceof Date&&!isNaN(t.valueOf())?t=t.toISOString():typeof t=="object"&&(t=JSON.stringify(t)),n.push(u(e)+"="+u(t))})}),n.length>0&&(e+=(e.indexOf("?")===-1?"?":"&")+n.join("&")),e},u=function(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")},o=function(e,n,r){var i=new XMLHttpRequest;return r.cache===!1&&(n+=(n.indexOf("?")===-1?"?":"&")+"_="+Date.now()),i.open(e.toUpperCase(),t(n)),i.responseType=r.responseType,i.withCredentials=r.withCredentials,Object.keys(r.headers).forEach(function(e){i.setRequestHeader(e,r.headers[e])}),i},i=function(e,t,r){var i=o("get",a(e,t),n.extend({},h,r));return c(i,function(){i.send(null)})},r=function(e,t,r){var i=o("post",e,n.extend({},h,{headers:{"Content-Type":"application/json;charset=UTF-8"}},r));return c(i,function(){t&&typeof t=="object"&&t instanceof FormData==0&&(t=JSON.stringify(t)),i.send(t)})},s=function(e,t,r){var i,s=o("post",e,n.extend({},h,r));return i=new FormData,Object.keys(t).forEach(function(e){var n=t[e],r=e==="file"?[e,n,n.name]:[e,n];return i.append.apply(i,r)}),c(s,function(){s.send(i)},!0)},{get:i,post:r,upload:s}}),define("src/events/notifier",["bluebird"],function(e){function n(){}function r(e,t){e.forEach(function(e){e(t)})}function i(e,t,n){e.forEach(function(e){e[t](n)})}function s(r,s,o){if(typeof t[s]=="undefined")return{resolveAt:n,rejectAt:n};var u=[],a=[];return t[s].forEach(function(t){var n=[],r=[],i=o.promises.map(function(){return new e(function(e,t){n.push(e),r.push(t)})});u.push(n),a.push(r),t(i,o)}),{resolveAt:function(e,t){i(u,e,t)},rejectAt:function(e,t){i(a,e,t)}}}function o(i,o,u){if(typeof i!="object"||i===null)throw new Error("target should be a function");if(typeof o!="string")throw new Error("eventName should be a string");u=u||{},u.eventTarget=i,u.eventName=o;if(u.promises&&u.promises.length)return s(i,o,u);if(typeof t[o]=="undefined")return{resolve:n,reject:n};var a=[],f=[];return t[o].forEach(function(t){var n=new e(function(e,t){a.push(e),f.push(t)});t(n,u)}),{resolve:function(e){r(a,e)},reject:function(e){r(f,e)}}}function u(e,n){typeof t[e]=="undefined"&&(t[e]=[]),t[e].push(n)}function a(e,n){if(t[e]){var r=t[e].indexOf(n);t[e].splice(r,1)}}var t={};return{emit:o,addListener:u,removeListener:a}}),define("src/sources/Source",["../utils/http","../events/notifier"],function(e,t){return function(n,r){if(typeof n!="function")throw new Error("Source constructor should be a function");if(typeof r=="undefined"||typeof r=="object"&&r!==null)return new n(r,t.emit,e);throw new Error("Source settings should be an object")}}),define("src/sources/private/mappers/folder",[],function(){return function(e){return{id:e.folder_id,name:e.folder_name,mediaType:e.media_type,filesCount:e.files_count,createdAt:e.created_ts}}}),define("src/utils/mappers",[],function(){return{toObject:function(e){return e?typeof e=="string"?JSON.parse(e):e:null},toError:function(e){return{code:e.status,message:e.statusText||e.data.message||e.data.error&&e.data.error.message||"",data:e.data.errors||e.data.error||e.data}}}}),define("src/sources/private/parsers/error",["bluebird","../../../utils/mappers"],function(e,t){return function(n){return n.status===403&&n.data.error_description==="Missing Wix session"&&(n.status=401,n.data.message="Wix Session required"),e.reject(t.toError(n))}}),define("src/sources/private/folders",["../../utils/http","./mappers/folder","./parsers/error"],function(e,t,n){return function(r){function i(e){return n(e)}function s(n,s){return s=s||{},e.get(r.apiUrl+"/folders",{media_type:s.mediaType||"picture",folder_id:n||null},{withCredentials:!0}).then(function(e){return{data:e.data.folders.map(t)}},i)}function o(t){return e.post(r.apiUrl+"/folders/"+t+"/delete",null,{withCredentials:!0}).then(function(){return t},i)}function u(e){return e.map(o)}return{list:s,remove:u}}}),define("src/sources/private/validators/new-props",[],function(){return function(e){return typeof e!="object"||e===null?{valid:!1,message:"Please specify new props"}:typeof e.name!="undefined"&&!e.name?{valid:!1,message:"Please specify name"}:typeof e.folderId!="undefined"&&!e.folderId?{valid:!1,message:"Please specify folder id"}:{valid:!0}}}),define("src/sources/private/folder",["../../utils/http","../../utils/utils","./mappers/folder","./parsers/error","./validators/new-props"],function(e,t,n,r,i){return function(s){function o(e){return r(e)}function u(t,r){return t?(r=r||{},e.post(s.apiUrl+"/folders",{folder_name:t,media_type:r.mediaType||"picture"},{withCredentials:!0}).then(function(e){return e.data=n(e.data),e},o)):o({status:-200,statusText:"Internal JS Error",data:{message:"Please specify name"}})}function a(n,r){var u=i(r);return u.valid===!1?o({status:-200,statusText:"Internal JS Error",data:{message:u.message}}):e.post(s.apiUrl+"/folders/"+n.id+"/put",{folder_name:r.name},{withCredentials:!0}).then(function(e){return e.data=t.merge(n,r),e},o)}return{create:u,update:a}}}),define("src/sources/private/mappers/item",["../../../utils/normalize-uri","../../../utils/mappers"],function(e,t){var n,r,i;return n=function(e,t){return t.imageOperationsApi==="rembrandt"?r(e,t):i(e,t)},r=function(t,n){function o(e){return e.replace(s,"")}function u(e){return s.exec(e)[1]}var r,i,s=/([^\/]+)$/;switch(t.media_type){case"picture":case"site_icon":return{thumbnailUrl:e(n.filesUrl+"/"+o(t.file_url)+"/v1/fill/w_195,h_195/"+u(t.file_url)),previewUrl:e(n.filesUrl+"/"+o(t.file_url)+"/v1/fit/w_375,h_375/"+u(t.file_url)),originalUrl:e(n.filesUrl+"/"+o(t.file_url)+"/"+u(t.file_url))};case"document":return{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/"+t.icon_url),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"music":case"secure_music":return{thumbnailUrl:"./images/music-preview.png",previewUrl:"./images/music-preview.png",originalUrl:e(n.filesUrl+"/"+t.file_url)};case"video":return i=t.icon_url?e(n.filesUrl+"/"+t.icon_url):"./images/video-preview.png",{thumbnailUrl:i,previewUrl:i,originalUrl:e(n.filesUrl+"/"+t.file_url)};case"ufonts":return r=t.file_name.replace(/\..*/,""),{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/media"+r+"_prvw.jpg"),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"swf":return{thumbnailUrl:e((n.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),previewUrl:e((n.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"watermark":return{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/"+t.icon_url),originalUrl:e(n.filesUrl+"/"+t.file_url)};default:return{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/"+t.icon_url),originalUrl:e(n.filesUrl+"/"+t.file_url)}}},i=function(t,n){var r;switch(t.media_type){case"picture":case"site_icon":return{thumbnailUrl:e(n.filesUrl+"/"+t.file_url+"_srz_210_210_75_22_0.5_1.20_0.00_jpg_srz"),previewUrl:e(n.filesUrl+"/"+t.file_url+"_srb_375_375_75_22_0.5_1.20_0.00_jpg_srb"),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"document":case"music":case"secure_music":return{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/"+t.icon_url),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"ufonts":return r=t.file_name.replace(/\..*/,""),{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/media"+r+"_prvw.jpg"),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"swf":return{thumbnailUrl:e((n.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),previewUrl:e((n.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),originalUrl:e(n.filesUrl+"/"+t.file_url)};case"watermark":return{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/"+t.icon_url),originalUrl:e(n.filesUrl+"/"+t.file_url)};default:return{thumbnailUrl:e(n.filesUrl+"/"+t.icon_url),previewUrl:e(n.filesUrl+"/"+t.icon_url),originalUrl:e(n.filesUrl+"/"+t.file_url)}}},function(r,i){var s={id:r.file_name,folderId:r.parent_folder_id||null,name:r.original_file_name,mediaType:r.media_type,fileUrl:e(r.file_url),createdAt:r.created_ts,tags:r.tags,width:r.width||null,height:r.height||null,fileInfo:t.toObject(r.file_info),fileInput:t.toObject(r.file_input),fileOutput:t.toObject(r.file_output)};return s.thumbnailUrl=n(r,i).thumbnailUrl,s.originalUrl=n(r,i).originalUrl,s.previewUrl=n(r,i).previewUrl,s}}),define("src/sources/private/items",["bluebird","../../utils/http","../../utils/normalize-uri","../../utils/utils","./mappers/item","./parsers/error"],function(e,t,n,r,i,s){return function(e){function n(e){return s(e)}function o(t){return!t.data.files||!t.data.files.length?[]:t.data.files.map(function(t){return i(t,e)})}function f(i,s){s=s||{};var f=r.extend(a,s.sort),l=r.extend(u,s.paging),c={page_size:l.size,cursor:s.cursor,parent_folder_id:i,media_type:s.mediaType};return c.order=f.direction==="desc"?"-"+f.order:f.order,t.get(e.apiUrl+"/files/getpage",c,{withCredentials:!0}).then(function(e){return{data:o(e),paging:{size:l.size,cursor:e.data.cursor}}},n)}function l(r){return t.post(e.apiUrl+"/files/"+r+"/delete",null,{withCredentials:!0}).then(function(){return r},n)}function c(e){return e.map(l)}var u={size:50,cursor:null},a={order:"date",direction:"desc"};return{list:f,remove:c}}}),define("src/sources/private/item",["bluebird","../../utils/http","../../utils/utils","../../utils/normalize-uri","./mappers/item","./parsers/error","./validators/new-props"],function(e,t,n,r,i,s,o){return function(u){function a(e){return s(e)}function f(e){function n(e){return e==="secure_music"?"music-goods/upload":e==="video"?"video/upload":"upload"}return t.get(u.apiUrl+"/files/"+n(e.mediaType)+"/url",{media_type:e.mediaType,file_name:e.name,file_size:e.size,content_type:e.file.type},{withCredentials:!0})}function l(n,s){s=s||{};var o={url:r(n.url),media_type:n.mediaType,name:n.name||"Untitled",tags:n.tags||null,parent_folder_id:s.folderId||null};return new e(function(e,n){t.post(u.apiUrl+"/files/upload/external?url="+o.url+"&media_type="+o.media_type,o,{withCredentials:!0}).then(function(t){e(i(t.data,u))},n)})}function c(n,r){r=r||{};var s={parent_folder_id:r.folderId||null,file:n.file,media_type:n.mediaType},o=new e(function(e,r){f(n).then(function(n){var a=t.upload(n.data.upload_url,s,{withCredentials:!0});a.progress(function(e){o.notify(e)}),a.then(function(t){e(i(t.data[0],u))},r)},r)});return o}function h(e){return t.get(u.apiUrl+"/files/"+e,null,{withCredentials:!0,cache:!1}).then(function(e){return i(e.data,u)},a)}function p(e,r){var i=o(r);return i.valid===!1?a({status:-200,statusText:"Internal JS Error",data:{message:i.message}}):t.post(u.apiUrl+"/files/"+e.id+"/put",{original_file_name:r.name,parent_folder_id:r.folderId},{withCredentials:!0}).then(function(t){return t.data=n.merge(e,r),t},a)}return{upload:c,uploadByUrl:l,get:h,update:p}}}),define("src/sources/private/settings",[],function(){return{apiUrl:"http://files.wix.com",imageOperationsApi:"vangogh",filesUrl:"http://static.wixstatic.com"}}),define("src/sources/decorators",["bluebird","../events/notifier","../utils/utils"],function(e,t,n){return{addEvents:function(r,i,s){var o={};return Object.keys(i).forEach(function(u){var a=n.snakeToCamel(u.toLowerCase());if(typeof s[a]!="function")return;o[a]=function(){var n=arguments,o=s[a].apply(s,n),f={arguments:n},l,c;return Array.isArray(o)?(f.promises=o,l=t.emit(r,i[u],f),o.forEach(function(e,t){var n=e.then(function(e){l.resolveAt(t,e)},function(e){l.rejectAt(t,e)});e.progress(function(e){n.notify(e)})}),o):(l=t.emit(r,i[u],f),c=o.then(function(e){return l.resolve(e),e},function(t){return l.reject(t),e.reject(t)}),o.progress(function(e){c.notify(e)}),c)}}),o}}}),define("src/events/list",[],function(){return{FOLDERS:{LIST:"folders.list",REMOVE:"folders.remove"},FOLDER:{CREATE:"folder.create",UPDATE:"folder.update",REMOVE:"folder.remove"},ITEMS:{LIST:"items.list",SEARCH:"items.search",REMOVE:"items.remove",UPLOAD:"items.upload",UPLOAD_BY_URL:"items.uploadByUrl"},ITEM:{GET:"item.get",UPDATE:"item.update",REMOVE:"item.remove",UPLOAD:"item.upload",UPLOAD_BY_URL:"item.uploadByUrl"}}}),define("src/services/upload-collection",["bluebird"],function(e){return function(t){function s(){var t,n,r=new e(function(){t=arguments[0],n=arguments[1]});return{resolve:t,reject:n,promise:r}}function o(e,t,o){var u=e.map(function(e){var t=s();return n.push({item:e,deferred:t}),t});return r||(r=!0,i(n,function(e){return o(e.item,t).progress(function(t){e.deferred.promise.notify(t)}).then(e.deferred.resolve,e.deferred.reject)})),u.map(function(e){return e.promise})}function u(e,n){return o(e,n,t.item.upload)}function a(e,n){return o(e,n,t.item.uploadByUrl)}var n=[],r=!1,i=function(e,t){var n=e.shift();console.log(n);if(!n){r=!1;return}t(n).finally(function(){i(e,t)})};this.upload=u,this.uploadByUrl=a}}),define("src/sources/private/Private",["./folders","./folder","./items","./item","./settings","../../utils/utils","../decorators","../../events/list","../../services/upload-collection"],function(e,t,n,r,i,s,o,u,a){return function(f){var l=s.extend({},i,f),c=e(l),h=t(l),p=n(l),d=r(l),v=new a(this);s.extend(p,{upload:v.upload,uploadByUrl:v.uploadByUrl}),this.name="private",this.folders=o.addEvents(this,u.FOLDERS,c),this.folder=o.addEvents(this,u.FOLDER,h),this.items=o.addEvents(this,u.ITEMS,p),this.item=o.addEvents(this,u.ITEM,d),this.items=o.addEvents(this,u.ITEMS,p),this.item=o.addEvents(this,u.ITEM,d)}}),define("src/sources/picasa/settings",[],function(){return{apiUrl:"http://pix-test.wix.com/services/google"}}),define("src/sources/picasa/mappers/folder",[],function(){return function(e){return{id:e.gphoto$id.$t,name:e.title.$t,mediaType:"picture",parentId:null,filesCount:e.gphoto$numphotos.$t,createdAt:e.published.$t}}}),define("src/sources/picasa/parsers/folders",["../mappers/folder"],function(e){return function(t){return{data:t.feed.entry.map(e)}}}),define("src/sources/picasa/parsers/error",["bluebird","../../../utils/mappers"],function(e,t){return function(n){return e.reject(t.toError(n))}}),define("src/sources/picasa/folders",["../../utils/http","./parsers/folders","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(){return e.get(r.apiUrl+"/albums",{thumbsize:"150c","max-results":500},{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/picasa/mappers/item",["../../../utils/normalize-uri"],function(e){function t(e){var t=e.media$thumbnail.filter(function(e){return!e.medium||e.medium!=="video"});return t[t.length-1].url||""}return function(n){var r,i,s,o,u;return r=t(n.media$group),i=+n.gphoto$width.$t||1024,s=+n.gphoto$height.$t||768,o=r.replace(/\/s[0-9]+/,"/w"+i+"-h"+s+"-no"),i>400?u=r.replace(/\/s[0-9]+(-c)?/,"/s400"):u=o,{id:n.id.$t,name:n.summary.$t||n.title.$t,mediaType:"picture",fileUrl:e(o),thumbnailUrl:e(r),previewUrl:e(u),createdAt:n.published.$t,tags:[],width:i,height:s}}}),define("src/sources/picasa/parsers/items",["../mappers/item"],function(e){return function(t){return{data:t.feed.entry.map(e),paging:{cursor:t.feed.openSearch$startIndex.$t+t.feed.openSearch$itemsPerPage.$t,pageSize:t.feed.openSearch$itemsPerPage.$t}}}}),define("src/sources/picasa/items",["../../utils/http","./parsers/items","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(t,n){n=n||{},n.paging=n.paging||{};var o={album_id:t||null,kind:"photo",thumbsize:"150c","max-results":n.paging.pageSize||50,"start-index":n.paging.cursor||1};return e.get(r.apiUrl+"/photos",o,{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/picasa/Picasa",["./settings","./folders","./items","../decorators","../../events/list"],function(e,t,n,r,i){return function(){var s=t(e),o=n(e);this.folders=r.addEvents(this,i.FOLDERS,s),this.items=r.addEvents(this,i.ITEMS,o),this.name="picasa"}}),define("src/sources/instagram/settings",[],function(){return{apiUrl:"http://pix-test.wix.com/services/instagram",api2Url:"http://pix-test.wix.com/services/instagram2"}}),define("src/sources/instagram/mappers/folder",[],function(){return function(e){return{id:"Instagram",name:"Instagram",mediaType:"picture",parentId:null,filesCount:e.counts.media,createdAt:null}}}),define("src/sources/instagram/parsers/folders",["../mappers/folder"],function(e){return function(t){return{data:[e(t)]}}}),define("src/sources/instagram/parsers/error",["bluebird","../../../utils/mappers"],function(e,t){return function(n){return n.status===500&&(n.status=403,n.data={message:"Unauthorized",result:"error"}),e.reject(t.toError(n))}}),define("src/sources/instagram/folders",["../../utils/http","./parsers/folders","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(){return e.get(r.apiUrl+"/user",null,{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/instagram/mappers/item",["../../../utils/normalize-uri"],function(e){return function(t){return t.caption||(t.caption={text:""}),{id:t.id,name:t.caption.text,mediaType:"picture",fileUrl:e(t.images.standard_resolution.url),thumbnailUrl:e(t.images.low_resolution.url),previewUrl:e(t.images.standard_resolution.url),createdAt:+t.created_time*1e3,tags:t.tags,width:t.images.standard_resolution.width,height:t.images.standard_resolution.height}}}),define("src/sources/instagram/parsers/items",["../mappers/item"],function(e){return function(t){t.next=t.next||{};var n=t.next.max_id||null,r=t.next.count||null;return{data:t.photos.map(e),paging:{cursor:n,pageSize:r}}}}),define("src/sources/instagram/items",["../../utils/http","./parsers/items","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(t,n){n=n||{},n.paging=n.paging||{};var o={count:n.paging.pageSize||50,max_id:n.paging.cursor||null};return e.get(r.api2Url+"/photos",o,{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/instagram/Instagram",["./settings","./folders","./items","../decorators","../../events/list"],function(e,t,n,r,i){return function(){var s=t(e),o=n(e);this.name="instagram",this.folders=r.addEvents(this,i.FOLDERS,s),this.items=r.addEvents(this,i.ITEMS,o)}}),define("src/sources/facebook/settings",[],function(){return{apiUrl:"http://pix-test.wix.com/services/facebook2"}}),define("src/sources/facebook/mappers/folder",[],function(){return function(e){return{id:e.id,name:e.name,mediaType:"picture",parentId:null,filesCount:e.count,createdAt:e.created_time}}}),define("src/sources/facebook/parsers/folders",["../mappers/folder"],function(e){return function(t){return{data:t.data.map(e)}}}),define("src/sources/facebook/parsers/error",["bluebird","../../../utils/mappers"],function(e,t){return function(n){return n.status===400&&n.data.error.code===190&&(n.status=403),e.reject(t.toError(n))}}),define("src/sources/facebook/folders",["../../utils/http","./parsers/folders","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(){return e.get(r.apiUrl+"/albums",null,{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/facebook/mappers/item",["../../../utils/normalize-uri","../../../utils/utils"],function(e,t){function n(e,n,r){r=r||190,n=n||190;var i,s,o;return e.length===1?e[0].source:(i=e.filter(function(e){return e.width>n&&e.height>r}),o=t.min(i,function(e){return e.width+e.height}),o?o.source:(s=t.max(e,function(e){return e.width+e.height}),s.source))}return function(t){return{id:t.id,folderId:null,name:t.name||"",mediaType:"picture",fileUrl:e(t.source),thumbnailUrl:e(n(t.images)),previewUrl:e(t.source),createdAt:t.created_time,tags:[],width:t.width,height:t.height}}}),define("src/sources/facebook/parsers/items",["../mappers/item"],function(e){return function(t){return t.paging=t.paging||{},t.paging.cursors=t.paging.cursors||{},t.paging.cursors.after=t.paging.cursors.after||null,{data:t.data.map(e),paging:{cursor:t.paging.cursors.after,pageSize:null}}}}),define("src/sources/facebook/items",["../../utils/http","./parsers/items","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(t,n){n=n||{},n.paging=n.paging||{};var o={album_id:t,limit:n.paging.pageSize||50,after:n.paging.cursor||null};return e.get(r.apiUrl+"/photos",o,{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/facebook/Facebook",["./settings","./folders","./items","../decorators","../../events/list"],function(e,t,n,r,i){return function(){var s=t(e),o=n(e);this.name="facebook",this.folders=r.addEvents(this,i.FOLDERS,s),this.items=r.addEvents(this,i.ITEMS,o)}}),define("src/sources/flickr/settings",[],function(){return{apiUrl:"http://pix-test.wix.com/services/flickr"}}),define("src/sources/flickr/mappers/folder",[],function(){return function(e){return{id:e.id,name:e.title._content,mediaType:"picture",parentId:null,filesCount:+e.photos+ +e.videos,createdAt:+e.date_create*1e3}}}),define("src/sources/flickr/parsers/folders",["../mappers/folder"],function(e){return function(t){return{data:t.photosets.photoset.map(e)}}}),define("src/sources/flickr/parsers/error",["bluebird","../../../utils/mappers"],function(e,t){return function(n){return e.reject(t.toError(n))}}),define("src/sources/flickr/folders",["../../utils/http","./parsers/folders","./parsers/error"],function(e,t,n){return function(r){function i(e){return t(e.data)}function s(e){return n(e)}function o(){return e.get(r.apiUrl+"/albums",{primary_photo_extras:"url_t,url_s,url_m,url_b,url_o"},{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/flickr/mappers/item",["../../../utils/normalize-uri"],function(e){function t(e){var t=e.url_m||e.url_s||e.url_t,n=e.url_b||t,r=e.url_o||n;return{fileUrl:r,thumbnailUrl:t,previewUrl:n}}return function(n){var r=t(n);return{id:n.id,name:n.title,folderId:null,mediaType:"picture",fileUrl:e(r.fileUrl),thumbnailUrl:e(r.thumbnailUrl),previewUrl:e(r.previewUrl),createdAt:null,tags:[],width:+(n.width_o||n.width_m||n.width_s||n.width_t),height:+(n.height_o||n.height_m||n.height_s||n.height_t)}}}),define("src/sources/flickr/parsers/items",["../mappers/item"],function(e){return function(t){var n=t.photoset.page<t.photoset.pages?t.photoset.page+1:null,r=+t.photoset.perpage;return{data:t.photoset.photo.map(e),paging:{cursor:n,pageSize:r}}}}),define("src/sources/flickr/items",["../../utils/http","./parsers/items","./parsers/error"],function(e,t,n){return function(r){function i(e){return e.data.stat==="fail"?n(e):t(e.data)}function s(e){return n(e)}function o(t,n){n=n||{},n.paging=n.paging||{};var o={extras:"url_t,url_s,url_m,url_b,url_o",set_id:t,per_page:n.paging.pageSize||50,page:n.paging.cursor||null};return e.get(r.apiUrl+"/photoset",o,{withCredentials:!0}).then(i,s)}return{list:o}}}),define("src/sources/flickr/Flickr",["./settings","./folders","./items","../decorators","../../events/list"],function(e,t,n,r,i){return function(){var s=t(e),o=n(e);this.name="flickr",this.folders=r.addEvents(this,i.FOLDERS,s),this.items=r.addEvents(this,i.ITEMS,o)}}),define("src/sources/list",["./private/Private","./picasa/Picasa","./instagram/Instagram","./facebook/Facebook","./flickr/Flickr"],function(e,t,n,r,i){return{PRIVATE:e,PICASA:t,INSTAGRAM:n,FACEBOOK:r,FLICKR:i}}),define("src/events/events",["./notifier","./list","../utils/utils"],function(e,t,n){function i(e,t){Object.defineProperty(r,e,{enumerable:!1,value:t})}var r={};return r=n.merge(t),i("on",e.addListener),i("off",e.removeListener),r}),define("src/connector/connector-settings",[],function(){return{PICASA:{connectUrl:"http://pix-test.wix.com/services/google/connect",disconnectUrl:"http://pix-test.wix.com/services/google/disconnect",parameterName:"goglact"},INSTAGRAM:{connectUrl:"http://pix-test.wix.com/services/instagram/connect",disconnectUrl:"http://pix-test.wix.com/services/instagram/disconnect",parameterName:"instact"},FACEBOOK:{connectUrl:"http://pix-test.wix.com/services/facebook/connect",disconnectUrl:"http://pix-test.wix.com/services/facebook/disconnect",parameterName:"fbact"},FLICKR:{connectUrl:"http://pix-test.wix.com/services/flickr/connect",disconnectUrl:"http://pix-test.wix.com/services/flickr/disconnect",parameterName:"flact"}}}),define("src/connector/connector",["bluebird","./connector-settings","../utils/http","../utils/utils"],function(e,t,n,r){return function(i,s){function u(){return o.parameterName}function a(){return!!localStorage.getItem(o.parameterName)}function f(){localStorage.removeItem(o.parameterName),n.get(o.disconnectUrl,null,{withCredentials:!0})}function l(){var t;return window.open(o.connectUrl+"?return_url="+s.redirectUrl,"connector","width=950,height=550"),t=new e(function(e,t){window.connectService=function(n){var i,s;i=r.getParameterByName(n,u()),s=r.getParameterByName(n,"status"),i&&(!s||s!=="FAIL")?e(i):t("Not Authorized")}}),t.then(function(e){localStorage.setItem(o.parameterName,e)},function(e){return e}),t}var o=t[i];if(typeof o!="object")throw new Error("Invalid source");return{isConnected:a,disconnect:f,connect:l}}}),define("src/services/bi/events-ids",[],function(){return{severity:{info:10,warning:20,error:30,fatal:40},BIEventsIds:{"folder.create":"112","folder.rename":"115","folder.remove":"117","item.remove":"118",responseTime:"125",searchItems:"126"},BIAdaptersIds:{"private":"01","public":"02",facebook:"03",flickr:"04",instagram:"05",picasa:"06",flickrSearch:"07",googleSearch:"08"},BIAdaptersRequestsIds:{"folders.list":"01","folder.create":"02","folder.rename":"03","folder.remove":"04","items.list":"11","item.upload":"12","item.uploadByUrl":"13","item.update":"14","item.remove":"15",moveItem:"16","items.search":"17",getMoreSearchedItems:"17",getItemsByTag:"18",transcodeItem:"19"}}}),define("src/services/bi/request",["./events-ids","../../utils/utils"],function(e,t){var n,r,i,s,o,u,a,f;return o=function(e,n){var r=document.createElement("img");r.setAttribute("src",e+"?"+t.encodeParams(n)),r=null},u=function(){return(new Date).getTime()},a=function(e,t,n){var r=e.name+"("+t+")",i=u()-n.startedAt;s({requestName:r,responseTime:i,isSuccess:n.isSuccess,responseSize:n.responseSize})},f=function(e,t){var n=u();e.then(function(e){a(t.eventTarget,t.eventName,{startedAt:n,responseSize:0,isSuccess:!0})}).catch(function(){a(t.eventTarget,t.eventName,{startedAt:n,responseSize:0,isSuccess:!1})})},n=function(){return"http://frog.wixpress.com"},i=function(e,t){return t.evid=e,o(n()+"/mg",t)},r=function(t,r,i){var s=i.code||"000",u=e.BIAdaptersIds[t]||"00",a=e.BIAdaptersRequestsIds[r]||"00",f=t+" "+r+": "+i.message,l=u+a+s;return o(n()+"/trg",{src:25,evid:10,iss:1,sev:e.severity.error,errc:l||"0000000",ver:"MEDIA_GALLERY_VERSION",site_id:"",httpc:s||"000",dsc:f||""})},s=function(t){return o(n()+"/mg",{evid:e.BIEventsIds.responseTime,call_name:t.requestName||"",ts:t.responseTime||0,result:t.isSuccess?"success":"fail",response_speed:Math.floor(t.responseSize||0/(t.responseTime/1e3)),response_size:t.responseSize})},{report:i,error:r,benchmark:f}}),define("src/services/bi/bi",["../../events/notifier","../../events/list","./request"],function(e,t,n){return function(r){var i=function(e,t){n.benchmark(e,t);var r=function(e,t,r){n.error(e.name,t,r)},i=function(e){},s=function(e){r(t.eventTarget,t.eventName,e)};return e.then(i,s)};Object.keys(t).forEach(function(n){Object.keys(t[n]).forEach(function(s){r===!0?e.addListener(t[n][s],i):e.removeListener(t[n][s],i)})})}}),define("src/wixmp",["./sources/Source","./sources/list","./events/events","./connector/connector","./services/bi/bi"],function(e,t,n,r,i){return{Source:e,sources:t,events:n,bi:i,connectExternalSource:r}});