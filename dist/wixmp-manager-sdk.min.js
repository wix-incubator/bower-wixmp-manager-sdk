/*!
 * wixmp-manager-sdk - v1.0.21 - 2015-03-11
 *
 * Copyright (c) 2015 Wix.com
 * Licensed MIT
 */

!function(){var a=window.Promise;window.Promise!==window.P&&console.warn("Bluebird is not available, cancel and progress will not work");var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb;!function(c){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=c(P);else{b=function(a){return"function"==typeof c?c(a):c}(a)}}(function(a){return a.defer=function(){var b,c,d=new a(function(){b=arguments[0],c=arguments[1]});return d.cancellable(),{resolve:b,reject:c,promise:d}},a.prototype.abort=function(){this.cancel({message:"aborted_by_user",code:-100})},a.prototype.progress=function(a){return this._progressCallback=a,this},a.prototype.notify=function(a){return"function"==typeof this._progressCallback&&this._progressCallback(a),this},a}),c=function(a){if("string"!=typeof a)throw new Error("URI is not a string");return a.replace(/([a-z\-_0-9]+)\/\//gi,"$1/")},d=function(){function a(a,b,c){var d;return c?(d=b.map(c),b[d.indexOf(Math[a].apply(null,d))]):Math[a].apply(this,b)}var b={extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){"object"==typeof b&&null!==b&&Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},merge:function(){var a=Object.prototype.hasOwnProperty;return Array.prototype.reduce.call(arguments,function(b,c){return Object.keys(b).forEach(function(d){a.call(c,d)&&(b[d]=c[d])}),Object.keys(c).forEach(function(a){b[a]=c[a]}),b},{})},bytesToSize:function(a){if(0===a)return"0 Byte";var b=1024,c=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(a)/Math.log(b));return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]},partial:function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=Array.prototype.slice.call(arguments);return a.apply(this,b.concat(c))}},getParameterByName:function(a,b){var c,d;return b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(a),d?decodeURIComponent(d[1].replace(/\+/g," ")):""},snakeToCamel:function(a){return a.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},find:function(a,b){var c;return a.some(function(a){return b(a)===!0?(c=a,!0):void 0}),c},encodeParams:function(a){var b=[],c=function(a,c){b[b.length]=encodeURIComponent(a)+"="+encodeURIComponent(c)};return Object.keys(a).forEach(function(b){c(b,a[b])}),b.join("&").replace(/%20/g,"+")},insertDataInTemplate:function(a,b){function c(a,b){return a=a.replace(/[()\[\]\.^$|?+]/g,"\\$&"),new RegExp(a,b)}return Object.keys(b).forEach(function(d){a=a.replace(c("#"+d+"#","g"),b[d])}),a},transformModeToVangogh:function(a){var b={fill:"srz",fit:"srb"};return b[a]}};return b.min=b.partial(a,"min"),b.max=b.partial(a,"max"),b}(),e={toObject:function(a){return a?"string"==typeof a?["{","["].indexOf(a[0])>=0?JSON.parse(a):{message:a}:a:null},toError:function(a){return{code:a.status,message:a.statusText||a.message||a.data.message||a.data.error&&a.data.error.message||"",data:a.data&&(a.data.errors||a.data.error||a.data)}}},f=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n;return n={withCredentials:!1,cache:!0,headers:{Accept:"application/json, text/plain, */*"}},m=function(b,e,f){var g=new a(function(a,e){b.addEventListener("error",function(){e(d.toError(c.extend({},b,{message:"error",code:-201})))},!1),b.addEventListener("timeout",function(){e(d.toError(c.extend({},b,{message:"timeout_has_exceeded",code:408})))},!1),b.addEventListener("load",function(){b.status.toString().match(/^2\d+/i)?a(k(b)):e(d.toError(c.extend({},b,{message:"error",code:b.status,data:d.toObject(b.responseText)})))},!1)});return f?b.upload.onprogress=function(a){var b=Math.round(a.lengthComputable?100*a.loaded/a.total:0),c=99>=b?"uploading":"processing";g.notify({status:c,total:a.total,loaded:a.loaded})}:(b.addEventListener("loadstart",function(a){a&&g.notify({status:"uploading",total:a.total,loaded:a.loaded})},!1),b.addEventListener("loadend",function(a){a&&g.notify({status:"processing",total:a.total,loaded:a.loaded})},!1)),g.cancellable()["catch"](function(a){"aborted_by_user"===a.message&&b.abort()}),e(),g},k=function(a){return{status:a.status,statusText:a.statusText,data:l(a.responseText)}},l=function(a){return"string"==typeof a&&(a=["{","["].indexOf(a[0])>=0?JSON.parse(a):{message:a}),a},j=function(a,b){if(!b)return a;var c=[];return Object.keys(b).forEach(function(a){var d=b[a];null!==d&&"undefined"!=typeof d&&(d instanceof Array||(d=[d]),d.forEach(function(b){b instanceof Date&&!isNaN(b.valueOf())?b=b.toISOString():"object"==typeof b&&(b=JSON.stringify(b)),c.push(i(a)+"="+i(b))}))}),c.length>0&&(a+=(-1===a.indexOf("?")?"?":"&")+c.join("&")),a},i=function(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")},h=function(a,c,d){var e=new XMLHttpRequest;return d.cache===!1&&(c+=(-1===c.indexOf("?")?"?":"&")+"_="+Date.now()),e.open(a.toUpperCase(),b(c)),e.responseType=d.responseType,e.withCredentials=d.withCredentials,Object.keys(d.headers).forEach(function(a){e.setRequestHeader(a,d.headers[a])}),e},f=function(a,b,d){var e=h("get",j(a,b),c.extend({},n,d));return m(e,function(){e.send(null)})},e=function(a,b,d){var e=h("post",a,c.extend({},n,{headers:{"Content-Type":"application/json;charset=UTF-8"}},d));return m(e,function(){b&&"object"==typeof b&&b instanceof FormData==!1&&(b=JSON.stringify(b)),e.send(b)})},g=function(a,b,d){var e,f=h("post",a,c.extend({},n,d));return e=new FormData,Object.keys(b).forEach(function(a){var c=b[a],d="file"===a?[a,c,c.name]:[a,c];return e.append.apply(e,d)}),m(f,function(){f.send(e)},!0)},{get:f,post:e,upload:g}}(b,c,d,e),g=function(a){function b(){}function c(a,b){a.forEach(function(a){a(b)})}function d(a,b,c){a.forEach(function(a){a[b](c)})}function e(c,e,f){if("undefined"==typeof i[e])return{resolveAt:b,rejectAt:b};var g=[],h=[];return i[e].forEach(function(b){var c=[],d=[],e=f.promises.map(function(){return new a(function(a,b){c.push(a),d.push(b)})});g.push(c),h.push(d),b(e,f)}),{resolveAt:function(a,b){d(g,a,b)},rejectAt:function(a,b){d(h,a,b)}}}function f(d,f,g){if("object"!=typeof d||null===d)throw new Error("target should be a function");if("string"!=typeof f)throw new Error("eventName should be a string");if(g=g||{},g.eventTarget=d,g.eventName=f,g.promises&&g.promises.length)return e(d,f,g);if("undefined"==typeof i[f])return{resolve:b,reject:b};var h=[],j=[];return i[f].forEach(function(b){var c=new a(function(a,b){h.push(a),j.push(b)});b(c,g)}),{resolve:function(a){c(h,a)},reject:function(a){c(j,a)}}}function g(a,b){"undefined"==typeof i[a]&&(i[a]=[]),i[a].push(b)}function h(a,b){if(i[a]){var c=i[a].indexOf(b);i[a].splice(c,1)}}var i={};return{emit:f,addListener:g,removeListener:h}}(b),h=function(a,b){return function(c,d){if("function"!=typeof c)throw new Error("Source constructor should be a function");if("undefined"!=typeof d&&("object"!=typeof d||null===d))throw new Error("Source settings should be an object");return new c(d,b.emit,a)}}(f,g),i=function(a){return{id:a.folder_id,name:a.folder_name,mediaType:a.media_type,filesCount:a.files_count,createdAt:a.created_ts}},j=function(a){return function(b){return 403===b.status&&"Missing Wix session"===b.data.error_description&&(b.status=401,b.data.message="Wix Session required"),a.reject(b)}}(b),k=function(a,b,c){return function(d){function e(a){return c(a)}function f(c,f){return f=f||{},a.get(d.apiUrl+"/folders",{media_type:f.mediaType||"picture",folder_id:c||null},{withCredentials:!0}).then(function(a){return{data:a.data.folders.map(b)}},e)}function g(b){return a.post(d.apiUrl+"/folders/"+b+"/delete",null,{withCredentials:!0}).then(function(){return b},e)}function h(a){return a.map(g)}return{list:f,remove:h}}}(f,i,j),l=function(a){return"object"!=typeof a||null===a?{valid:!1,message:"Please specify new props"}:"undefined"==typeof a.name||a.name?"undefined"==typeof a.folderId||a.folderId?{valid:!0}:{valid:!1,message:"Please specify folder id"}:{valid:!1,message:"Please specify name"}},m=function(a,b,c,d,e,f){return function(g){function h(a){return e(a)}function i(c,e){return c?(e=e||{},a.post(g.apiUrl+"/folders",{folder_name:c,media_type:e.mediaType||"picture"},{withCredentials:!0}).then(function(a){return a.data=d(a.data),a},h)):h(b.toError({status:-200,statusText:"Internal JS Error",data:{message:"Please specify name"}}))}function j(d,e){var i=f(e);return i.valid===!1?h(b.toError({status:-200,statusText:"Internal JS Error",data:{message:i.message}})):a.post(g.apiUrl+"/folders/"+d.id+"/put",{folder_name:e.name},{withCredentials:!0}).then(function(a){return a.data=c.merge(d,e),a},h)}return{create:i,update:j}}}(f,e,d,i,j,l),n=function(a,b,c){var d,e,f;return d=function(a,b){return"rembrandt"===b.imageOperationsApi?e.apply(this,arguments):f.apply(this,arguments)},e=function(b,c){function d(a){return a.replace(f,"")}function e(a){return f.exec(a)[1]}var f=/([^\/]+)$/;switch(b.media_type){case"picture":case"site_icon":return{thumbnail:a(c.filesUrl+"/"+d(b.file_url)+"/v1/#mode#/w_#width#,h_#height#/"+e(b.file_url)),original:a(c.filesUrl+"/"+d(b.file_url)+"/"+e(b.file_url))};case"document":return{thumbnail:a(c.filesUrl+"/"+b.icon_url),original:a(c.filesUrl+"/"+b.file_url)};case"music":case"secure_music":return{thumbnail:"./images/music-preview.png",original:a(c.filesUrl+"/"+b.file_url)};case"video":return{thumbnail:b.icon_url?a(c.filesUrl+"/"+b.icon_url):"./images/video-preview.png",original:a(c.filesUrl+"/"+b.file_url)};case"ufonts":return{thumbnail:a(c.filesUrl+"/"+b.icon_url),preview:a(c.filesUrl+"/media"+b.file_name.replace(/\..*/,"")+"_prvw.jpg"),original:a(c.filesUrl+"/"+b.file_url)};case"swf":return{thumbnail:a((c.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),original:a(c.filesUrl+"/"+b.file_url)};case"watermark":return{thumbnail:a(c.filesUrl+"/"+b.icon_url),original:a(c.filesUrl+"/"+b.file_url)};default:return{thumbnail:a(c.filesUrl+"/"+b.icon_url),original:a(c.filesUrl+"/"+b.file_url)}}},f=function(b,c){switch(b.media_type){case"picture":case"site_icon":return{thumbnail:a(c.filesUrl+"/"+b.file_url+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"),original:a(c.filesUrl+"/"+b.file_url)};case"document":case"music":case"secure_music":return{thumbnail:a(c.filesUrl+"/"+b.icon_url),original:a(c.filesUrl+"/"+b.file_url)};case"ufonts":return{thumbnail:a(c.filesUrl+"/"+b.icon_url),preview:a(c.filesUrl+"/media"+b.file_name.replace(/\..*/,"")+"_prvw.jpg"),original:a(c.filesUrl+"/"+b.file_url)};case"swf":return{thumbnail:a((c.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),original:a(c.filesUrl+"/"+b.file_url)};case"watermark":return{thumbnail:a(c.filesUrl+"/"+b.icon_url),original:a(c.filesUrl+"/"+b.file_url)};default:return{thumbnail:a(c.filesUrl+"/"+b.icon_url),original:a(c.filesUrl+"/"+b.file_url)}}},function(e,f,g){function h(a){return Object.keys(g).reduce(function(b,d){var e=d+"Url",h=c.extend({},g[d]),i=a[d]||a.thumbnail;return"vangogh"===f.imageOperationsApi&&(h.mode=c.transformModeToVangogh(h.mode)),b[e]=c.insertDataInTemplate(i,h),b},{})}var i={id:e.file_name,folderId:e.parent_folder_id||null,name:e.original_file_name,mediaType:e.media_type,fileUrl:a(e.file_url),createdAt:e.created_ts,tags:e.tags,width:e.width||null,height:e.height||null,fileInfo:b.toObject(e.file_info),fileInput:b.toObject(e.file_input),fileOutput:b.toObject(e.file_output)};return g=c.extend(f.thumbnailSizes,g),i=c.extend(i,h(d(e,f)))}}(c,e,d),o=function(a,b,c,d,e,f){return function(a){function c(a){return f(a)}function g(b,c){return b.data.files?b.data.files.map(function(b){return e(b,a,c)}):[]}function h(e,f){f=f||{};var h=d.extend(m,f.sort),i=d.extend(l,f.paging),j={page_size:i.size,cursor:i.cursor,parent_folder_id:e,media_type:f.mediaType};return j.order="desc"===h.direction?"-"+h.order:h.order,b.get(a.apiUrl+"/files/getpage",j,{withCredentials:!0}).then(function(a){return{data:g(a,f.thumbnails),paging:{size:i.size,cursor:a.data.cursor}}})["catch"](c)}function i(d){return b.post(a.apiUrl+"/files/"+d+"/delete",null,{withCredentials:!0}).then(function(){return d})["catch"](c)}function j(a){return a.map(i)}function k(e,f){f=f||{};var h=d.extend(m,f.sort),i=d.extend(l,f.paging),j={page_size:i.size,cursor:i.cursor,media_type:f.mediaType,order:"desc"===h.direction?"-"+h.order:h.order};return b.get(a.apiUrl+"/files/get?tag="+e,j,{withCredentials:!0,cache:!1}).then(function(a){return{data:g(a),paging:{size:i.size,cursor:a.data.cursor}}})["catch"](c)}var l={size:50,cursor:null},m={order:"date",direction:"desc"};return{list:h,remove:j,searchByTag:k}}}(b,f,c,d,n,j),p=function(a,b,c,d,e,f,g,h){return function(i){function j(a){return i.uploadLimits[c.snakeToCamel(a)]}function k(a){return a.file.size>=j(a.mediaType)}function l(a){"function"==typeof a&&s.push(a)}function m(a){return f(a)}function n(a){function c(a){return"secure_music"===a?"music-goods/upload":"video"===a?"video/upload":"upload"}return b.get(i.apiUrl+"/files/"+c(a.mediaType)+"/url",{media_type:a.mediaType,file_name:a.name,file_size:a.size,content_type:a.file.type},{withCredentials:!0})}function o(a){var c={url:encodeURIComponent(d(a.url)),media_type:a.mediaType,name:a.name||"Untitled",tags:a.tags||null,parent_folder_id:a.folderId||null},f=i.apiUrl+"/files/upload/external?url="+c.url+"&media_type="+c.media_type,g=b.post(f,c,{withCredentials:!0}).progress(function(a){g.notify(a)}).then(function(a){return e(a.data,i)});return g}function p(d){var f={parent_folder_id:d.folderId||null,file:d.file,media_type:d.mediaType};if(k(d))return a.reject(h.toError({status:-406,statusText:"Not Acceptable",data:{error_description:"File size is bigger than "+c.bytesToSize(j(d.mediaType))}}));var g=n(d).then(function(a){return b.upload(a.data.upload_url,f,{withCredentials:!0}).progress(function(a){g.notify(a)})}).then(function(a){return e(a.data[0],i)});return g}function q(a){return b.get(i.apiUrl+"/files/"+a,null,{withCredentials:!0,cache:!1}).then(function(a){return e(a.data,i)},m)}function r(a,d){var e=g(d);if(e.valid===!1)return m(h.toError({status:-200,statusText:"Internal JS Error",data:{message:e.message}}));d.tags=d.tags||a.tags||[];var f=d.tags.join(",");return b.post(i.apiUrl+"/files/"+a.id+"/put",{original_file_name:d.name,parent_folder_id:d.folderId,tags:f},{withCredentials:!0}).then(function(b){return b.data=c.merge(a,d),b},m)}var s=[];return{onItemUploadProgress:l,upload:p,uploadByUrl:o,get:q,update:r}}}(b,f,d,c,n,j,l,e),q={apiUrl:"http://files.wix.com",imageOperationsApi:"vangogh",filesUrl:"http://static.wixstatic.com",uploadLimits:{"default":15728640,document:15728640,picture:15728640,music:52428800,video:524288e3,secureMusic:157286400},thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"},original:{width:1e3,height:1e3,mode:"fit"}}},r=function(a,b,c){return{addEvents:function(d,e,f){var g={};return Object.keys(e).forEach(function(h){var i=c.snakeToCamel(h.toLowerCase());"function"==typeof f[i]&&(g[i]=function(){var c,g,j=arguments,k=f[i].apply(f,j),l={arguments:j};return Array.isArray(k)?(l.promises=k,c=b.emit(d,e[h],l),k.forEach(function(a,b){var d=a.then(function(a){c.resolveAt(b,a)},function(a){c.rejectAt(b,a)});a.progress(function(a){d.notify(a)})}),k):(c=b.emit(d,e[h],l),g=k.then(function(a){return c.resolve(a),a},function(b){return c.reject(b),a.reject(b)}),k.progress(function(a){g.notify(a)}),g)})}),g}}}(b,g,d),s={FOLDERS:{LIST:"folders.list",REMOVE:"folders.remove"},FOLDER:{CREATE:"folder.create",UPDATE:"folder.update",REMOVE:"folder.remove"},ITEMS:{LIST:"items.list",SEARCH:"items.search",REMOVE:"items.remove",UPLOAD:"items.upload",UPLOAD_BY_URL:"items.uploadByUrl",SEARCH_BY_TAG:"items.searchByTag"},ITEM:{GET:"item.get",UPDATE:"item.update",REMOVE:"item.remove",UPLOAD:"item.upload",UPLOAD_BY_URL:"item.uploadByUrl"}},t=function(a,b,c,d,e,f,g,h){return function(i){var j=f.extend({},e,i),k=a(j),l=b(j),m=c(j),n=d(j);this.name="private",this.folders=g.addEvents(this,h.FOLDERS,k),this.folder=g.addEvents(this,h.FOLDER,l),this.item=g.addEvents(this,h.ITEM,n),this.items=g.addEvents(this,h.ITEMS,m)}}(k,m,o,p,q,d,r,s),u={apiUrl:"http://pix-test.wix.com/services/google"},v=function(a){return{id:a.gphoto$id.$t,name:a.title.$t,mediaType:"picture",parentId:null,filesCount:a.gphoto$numphotos.$t,createdAt:a.published.$t}},w=function(a){return function(b){return{data:b.feed.entry.map(a)}}}(v),x=function(a){return function(b){return a.reject(b)}}(b),y=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/albums",{thumbsize:"150c","max-results":500},{withCredentials:!0}).then(e)["catch"](f)}return{list:g}}}(f,w,x),z=function(a){function b(a){var b=a.media$thumbnail.filter(function(a){return!a.medium||"video"!==a.medium});return b[b.length-1].url||""}return function(c){var d,e,f,g,h;return d=b(c.media$group),e=+c.gphoto$width.$t||1024,f=+c.gphoto$height.$t||768,g=d.replace(/\/s[0-9]+/,"/w"+e+"-h"+f+"-no"),h=e>400?d.replace(/\/s[0-9]+(-c)?/,"/s400"):g,{id:c.id.$t,name:c.summary.$t||c.title.$t,mediaType:"picture",fileUrl:a(g),thumbnailUrl:a(d),previewUrl:a(h),createdAt:c.published.$t,tags:[],width:e,height:f}}}(c),A=function(a){return function(b){return{data:b.feed.entry.map(a),paging:{cursor:b.feed.openSearch$startIndex.$t+b.feed.openSearch$itemsPerPage.$t,pageSize:b.feed.openSearch$itemsPerPage.$t}}}}(z),B=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={album_id:b||null,kind:"photo",thumbsize:"150c","max-results":c.paging.pageSize||50,"start-index":c.paging.cursor||1};return a.get(d.apiUrl+"/photos",g,{withCredentials:!0}).then(e,f)}return{list:g}}}(f,A,x),C=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g),this.name="picasa"}}(u,y,B,r,s),D={apiUrl:"http://pix-test.wix.com/services/instagram",api2Url:"http://pix-test.wix.com/services/instagram2"},E=function(a){return{id:"Instagram",name:"Instagram",mediaType:"picture",parentId:null,filesCount:a.counts.media,createdAt:null}},F=function(a){return function(b){return{data:[a(b)]}}}(E),G=function(a){return function(b){return 500===b.code&&(b.code=403,b.data={message:"Unauthorized",result:"error"}),a.reject(b)}}(b),H=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/user",null,{withCredentials:!0}).then(e,f)}return{list:g}}}(f,F,G),I=function(a){return function(b){return b.caption||(b.caption={text:""}),{id:b.id,name:b.caption.text,mediaType:"picture",fileUrl:a(b.images.standard_resolution.url),thumbnailUrl:a(b.images.low_resolution.url),previewUrl:a(b.images.standard_resolution.url),createdAt:1e3*+b.created_time,tags:b.tags,width:b.images.standard_resolution.width,height:b.images.standard_resolution.height}}}(c),J=function(a){return function(b){b.next=b.next||{};var c=b.next.max_id||null,d=b.next.count||null;return{data:b.photos.map(a),paging:{cursor:c,pageSize:d}}}}(I),K=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={count:c.paging.pageSize||50,max_id:c.paging.cursor||null};return a.get(d.api2Url+"/photos",g,{withCredentials:!0}).then(e,f)}return{list:g}}}(f,J,G),L=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.name="instagram",this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g)}}(D,H,K,r,s),M={apiUrl:"http://pix-test.wix.com/services/facebook2"},N=function(a){return{id:a.id,name:a.name,mediaType:"picture",parentId:null,filesCount:a.count,createdAt:a.created_time}},O=function(a){return function(b){return{data:b.data.map(a)}}}(N),Q=function(a){return function(b){return 400===b.code&&190===b.data.code&&(b.code=403),a.reject(b)}}(b),R=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/albums",null,{withCredentials:!0}).then(e,f)}return{list:g}}}(f,O,Q),S=function(a,b){function c(a,c,d){d=d||190,c=c||190;var e,f,g;return 1===a.length?a[0].source:(e=a.filter(function(a){return a.width>c&&a.height>d}),(g=b.min(e,function(a){return a.width+a.height}))?g.source:(f=b.max(a,function(a){return a.width+a.height}),f.source))}return function(b){return{id:b.id,folderId:null,name:b.name||"",mediaType:"picture",fileUrl:a(b.source),thumbnailUrl:a(c(b.images)),previewUrl:a(b.source),createdAt:b.created_time,tags:[],width:b.width,height:b.height}}}(c,d),T=function(a){return function(b){return b.paging=b.paging||{},b.paging.cursors=b.paging.cursors||{},b.paging.cursors.after=b.paging.cursors.after||null,{data:b.data.map(a),paging:{cursor:b.paging.cursors.after,pageSize:null}}}}(S),U=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={album_id:b,limit:c.paging.pageSize||50,after:c.paging.cursor||null};return a.get(d.apiUrl+"/photos",g,{withCredentials:!0}).then(e,f)}return{list:g}}}(f,T,Q),V=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.name="facebook",this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g)}}(M,R,U,r,s),W={apiUrl:"http://pix-test.wix.com/services/flickr"},X=function(a){return{id:a.id,name:a.title._content,mediaType:"picture",parentId:null,filesCount:+a.photos+ +a.videos,createdAt:1e3*+a.date_create}},Y=function(a){return function(b){return{data:b.photosets.photoset.map(a)}}}(X),Z=function(a){return function(b){return a.reject(b)}}(b),$=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/albums",{primary_photo_extras:"url_t,url_s,url_m,url_b,url_o"},{withCredentials:!0}).then(e,f)}return{list:g}}}(f,Y,Z),_=function(a){function b(a){var b=a.url_m||a.url_s||a.url_t,c=a.url_b||b,d=a.url_o||c;return{fileUrl:d,thumbnailUrl:b,previewUrl:c}}return function(c){var d=b(c);return{id:c.id,name:c.title,folderId:null,mediaType:"picture",fileUrl:a(d.fileUrl),thumbnailUrl:a(d.thumbnailUrl),previewUrl:a(d.previewUrl),createdAt:null,tags:[],width:+(c.width_o||c.width_m||c.width_s||c.width_t),height:+(c.height_o||c.height_m||c.height_s||c.height_t)}}}(c),ab=function(a){return function(b){var c=b.photoset.page<b.photoset.pages?b.photoset.page+1:null,d=+b.photoset.perpage;return{data:b.photoset.photo.map(a),paging:{cursor:c,pageSize:d}}}}(_),bb=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={extras:"url_t,url_s,url_m,url_b,url_o",set_id:b,per_page:c.paging.pageSize||50,page:c.paging.cursor||null};return a.get(d.apiUrl+"/photoset",g,{withCredentials:!0}).then(e)["catch"](f)}return{list:g}}}(f,ab,Z),cb=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.name="flickr",this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g)}}(W,$,bb,r,s),db=function(a,b,c,d,e){return{PRIVATE:a,PICASA:b,INSTAGRAM:c,FACEBOOK:d,FLICKR:e}}(t,C,L,V,cb),eb=function(a,b,c){function d(a,b){Object.defineProperty(e,a,{enumerable:!1,value:b})}var e={};return e=c.merge(b),d("on",a.addListener),d("off",a.removeListener),e}(g,s,d),fb={PICASA:{connectUrl:"http://pix-test.wix.com/services/google/connect",disconnectUrl:"http://pix-test.wix.com/services/google/disconnect",parameterName:"goglact"},INSTAGRAM:{connectUrl:"http://pix-test.wix.com/services/instagram/connect",disconnectUrl:"http://pix-test.wix.com/services/instagram/disconnect",parameterName:"instact"},FACEBOOK:{connectUrl:"http://pix-test.wix.com/services/facebook/connect",disconnectUrl:"http://pix-test.wix.com/services/facebook/disconnect",parameterName:"fbact"},FLICKR:{connectUrl:"http://pix-test.wix.com/services/flickr/connect",disconnectUrl:"http://pix-test.wix.com/services/flickr/disconnect",parameterName:"flact"}},gb=function(a,b,c,d){return function(e,f){function g(){return k.parameterName}function h(){return!!localStorage.getItem(k.parameterName)}function i(){return localStorage.removeItem(k.parameterName),c.get(k.disconnectUrl,null,{withCredentials:!0})}function j(){var b;return window.open(k.connectUrl+"?return_url="+f.redirectUrl,"connector","width=950,height=550"),b=new a(function(a,b){window.connectService=function(c){var e,f;e=d.getParameterByName(c,g()),f=d.getParameterByName(c,"status"),!e||f&&"FAIL"===f?b("Not Authorized"):a(e)}}),b.then(function(a){localStorage.setItem(k.parameterName,a)},function(a){return a}),b}var k=b[e];if("object"!=typeof k)throw new Error("Invalid source");return{isConnected:h,disconnect:i,connect:j}}}(b,fb,f,d),hb={severity:{info:10,warning:20,error:30,fatal:40},BIEventsIds:{"folder.create":"112","folder.rename":"115","folder.remove":"117","item.remove":"118",responseTime:"125",searchItems:"126"},BIAdaptersIds:{"private":"01","public":"02",facebook:"03",flickr:"04",instagram:"05",picasa:"06",flickrSearch:"07",googleSearch:"08"},BIAdaptersRequestsIds:{"folders.list":"01","folder.create":"02","folder.rename":"03","folder.remove":"04","items.list":"11","item.upload":"12","item.uploadByUrl":"13","item.update":"14","item.remove":"15",moveItem:"16","items.search":"17",getMoreSearchedItems:"17",getItemsByTag:"18",transcodeItem:"19"}},ib=function(a,b){function c(a,c){var d=document.createElement("img");d.setAttribute("src",a+"?"+b.encodeParams(c)),d=null}function d(){return(new Date).getTime()}function e(){return"http://frog.wixpress.com"}function f(b){return c(e()+"/mg",{evid:a.BIEventsIds.responseTime,call_name:b.requestName||"",ts:b.responseTime||0,result:b.isSuccess?"success":"fail",response_speed:Math.floor(b.responseSize||0/(b.responseTime/1e3)),response_size:b.responseSize})}function g(a,b,c){var e=a.name+"("+b+")",g=d()-c.startedAt;f({requestName:e,responseTime:g,isSuccess:c.isSuccess,responseSize:c.responseSize})}function h(a,b){var c=d();a.then(function(){g(b.eventTarget,b.eventName,{startedAt:c,responseSize:0,isSuccess:!0})})["catch"](function(){g(b.eventTarget,b.eventName,{startedAt:c,responseSize:0,isSuccess:!1})})}function i(a,b){return b.evid=a,c(e()+"/mg",b)}function j(b,d,f){var g=f.code||"000",h=a.BIAdaptersIds[b]||"00",i=a.BIAdaptersRequestsIds[d]||"00",j=b+" "+d+": "+f.message,k=h+i+g;return c(e()+"/trg",{src:25,evid:10,iss:1,sev:a.severity.error,errc:k||"0000000",ver:"MEDIA_GALLERY_VERSION",site_id:"",httpc:g||"000",dsc:j||""})}return{report:i,error:j,benchmark:h}}(hb,d),jb=function(a,b,c){return function(d){var e=function(a,b){c.benchmark(a,b);var d=function(a,b,d){c.error(a.name,b,d)},e=function(){},f=function(a){d(b.eventTarget,b.eventName,a)};return a.then(e,f)};Object.keys(b).forEach(function(c){Object.keys(b[c]).forEach(function(f){d===!0?a.addListener(b[c][f],e):a.removeListener(b[c][f],e)})})}}(g,s,ib),kb=function(a){function b(a){return"waiting"===a.status||"uploading"===a.status}function c(a){a.status="failed",a.deferred.promise["catch"](function(b){a.error=b}),a.deferred.promise.abort()}function d(a,b){a.status="uploading",a.uploadPromise=b.uploadFn(a.source).progress(function(b){a.deferred.promise.notify(b)}).then(function(b){a.deferred.resolve(b)})["catch"](function(b){a.error=b,a.deferred.reject(b)})}function e(){var b=a.defer();return b.promise["catch"](function(a){console.log(a)}),b.promise.cancellable(),b}function f(a){return{source:a.source,status:"waiting",bytesLoaded:0,deferred:e(),isAborted:!1,error:{},upload:function(){return this.isAborted||d(this,a),this.deferred.promise},abort:function(){if(b(this)){if(this.isAborted=!0,"waiting"===this.status)return void c(this);this.status="failed",this.uploadPromise.abort()}},canRetry:function(){if(!this.error.code)return!1;var a=[-100,-201,-406];return"failed"===this.status&&-1!==a.indexOf(this.error.code)?!0:!1},signUpForRetry:function(){this.status="waiting",this.isAborted=!1,this.error={},this.deferred=e()},canAbort:function(){return b(this)}}}return f}(b),lb=function(a,b){function c(a){return function(b){return b.name===a}}function d(a,b){"string"==typeof a&&(a=[a]),a.forEach(function(a){if(!w.indexOf(a))throw new Error("This event"+a+"is not supported by multiple file uploader");x.push({name:a,fn:b})})}function e(a,b){var d=[].slice;b=arguments.length>=2?d.call(arguments,1):[],x.filter(c(a)).forEach(function(c){c.fn.apply({event:a},b)})}function f(){return 0!==r.filter(function(a){return"waiting"===a.status}).length}function g(){return r.some(function(a){return a.canRetry()})}function h(a,b){var c=a[u];return c&&"waiting"!==c.status?(u++,h(a,b),t.promise):c||f()?!c&&f()?(u=0,h(a,b),t.promise):(b(c)["finally"](function(){u++,h(a,b)}),t.promise):(s=!1,u=0,t.resolve(),t.promise)}function i(a){return a.source.file?a.source.file.size:1}function j(){return r.reduce(function(a,b){return a+i(b)},0)}function k(a,b){switch(b.status){case"uploading":return b.loaded<=i(a)?b.loaded:i(a);case"succeeded":case"processing":return i(a);case"failed":return 0;default:return 0}}function l(a){return function(b){a.status=b.status,a.bytesLoaded=b.loaded,b.file=a,e("fileStatusChanged",{bytesUploaded:v+k(a,b),bytesTotal:j(),currentFileProgress:b,currentFileQueueIdx:u})}}function m(a){return a.upload()}function n(a){var b=l(a);a.deferred.promise.progress(b).then(function(){b({status:"succeeded",total:i(a),loaded:i(a)}),v+=i(a)})["catch"](function(){b({status:"failed",total:i(a),loaded:0})})}function o(){e("uploadQueueStarted",r),h(r,m)["finally"](function(){e("uploadQueueFinished",r)})}function p(){if(s)throw new Error("Upload queue can not be cleared while upload is running");r.length=0,v=0}function q(c){c=c||[],s||g()||(p(),t=a.defer());var d=c.map(b);return d.forEach(function(a){n(a);var b=a.signUpForRetry;a.signUpForRetry=function(){b.apply(this,arguments),n(a),s||(s=!0,o())},r.push(a)}),e("queueChange",r),s||(s=!0,o()),d}var r=[],s=!1,t=a.defer(),u=0,v=0,w=["queueChanged","fileStatusChanged","uploadQueueStarted","uploadQueueFinished"],x=[];return{on:d,upload:q,clearQueue:p}}(b,kb),mb=function(a,b,c,d,e,f){return{Source:a,sources:b,events:c,bi:e,connectExternalSource:d,Uploader:f}}(h,db,eb,gb,jb,lb),window.wixmp=mb}();