/*!
 * wixmp-manager-sdk - v1.0.22 - 2015-03-12
 *
 * Copyright (c) 2015 Wix.com
 * Licensed MIT
 */

!function(){var a=window.Promise;window.Promise!==window.P&&console.warn("Bluebird is not available, cancel and progress will not work");var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,Q,R,S,T,U,V,W,X,Y,Z,$,_,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb;!function(c){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=c(P);else{b=function(a){return"function"==typeof c?c(a):c}(a)}}(function(a){return a.defer=function(){var b,c,d=new a(function(){b=arguments[0],c=arguments[1]});return d.cancellable(),{resolve:b,reject:c,promise:d}},a.prototype.abort=function(){this.cancel({message:"aborted_by_user",code:-100})},a.prototype.progress=function(a){return this._progressCallback=a,this},a.prototype.notify=function(a){return"function"==typeof this._progressCallback&&this._progressCallback(a),this},a}),c=function(){function a(a,b,c){var d;return c?(d=b.map(c),b[d.indexOf(Math[a].apply(null,d))]):Math[a].apply(this,b)}var b={extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){"object"==typeof b&&null!==b&&Object.keys(b).forEach(function(c){a[c]=b[c]})}),a},merge:function(){var a=Object.prototype.hasOwnProperty;return Array.prototype.reduce.call(arguments,function(b,c){return Object.keys(b).forEach(function(d){a.call(c,d)&&(b[d]=c[d])}),Object.keys(c).forEach(function(a){b[a]=c[a]}),b},{})},bytesToSize:function(a){if(0===a)return"0 Byte";var b=1024,c=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],d=Math.floor(Math.log(a)/Math.log(b));return(a/Math.pow(b,d)).toPrecision(3)+" "+c[d]},partial:function(a){var b=Array.prototype.slice.call(arguments,1);return function(){var c=Array.prototype.slice.call(arguments);return a.apply(this,b.concat(c))}},getParameterByName:function(a,b){var c,d;return b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),c=new RegExp("[\\?&]"+b+"=([^&#]*)"),d=c.exec(a),d?decodeURIComponent(d[1].replace(/\+/g," ")):""},snakeToCamel:function(a){return a.replace(/(\_[a-z])/g,function(a){return a.toUpperCase().replace("_","")})},find:function(a,b){var c;return a.some(function(a){return b(a)===!0?(c=a,!0):void 0}),c},encodeParams:function(a){var b=[],c=function(a,c){b[b.length]=encodeURIComponent(a)+"="+encodeURIComponent(c)};return Object.keys(a).forEach(function(b){c(b,a[b])}),b.join("&").replace(/%20/g,"+")},insertDataInTemplate:function(a,b){function c(a,b){return a=a.replace(/[()\[\]\.^$|?+]/g,"\\$&"),new RegExp(a,b)}return Object.keys(b).forEach(function(d){a=a.replace(c("#"+d+"#","g"),b[d])}),a},transformModeToVangogh:function(a){var b={fill:"srz",fit:"srb"};return b[a]},splitTags:function(a){return a?Array.isArray(a)?a:a.split(/\s*,\s*/):[]},normalizeUri:function(a){if("string"!=typeof a)throw new Error("URI is not a string");return a.replace(/([a-z\-_0-9]+)\/\//gi,"$1/")}};return b.min=b.partial(a,"min"),b.max=b.partial(a,"max"),b}(),d={toObject:function(a){return a?"string"==typeof a?["{","["].indexOf(a[0])>=0?JSON.parse(a):{message:a}:a:null},toError:function(a){return{code:a.status,message:a.statusText||a.message||a.data.message||a.data.error&&a.data.error.message||"",data:a.data&&(a.data.errors||a.data.error||a.data)}}},e=function(a,b,c){var d,e,f,g,h,i,j,k,l,m;return m={withCredentials:!1,cache:!0,headers:{Accept:"application/json, text/plain, */*"}},l=function(d,e,f){var g=new a(function(a,e){d.addEventListener("error",function(){e(c.toError(b.extend({},d,{message:"error",code:-201})))},!1),d.addEventListener("timeout",function(){e(c.toError(b.extend({},d,{message:"timeout_has_exceeded",code:408})))},!1),d.addEventListener("load",function(){d.status.toString().match(/^2\d+/i)?a(j(d)):e(c.toError(b.extend({},d,{message:"error",code:d.status,data:c.toObject(d.responseText)})))},!1)});return f?d.upload.onprogress=function(a){var b=Math.round(a.lengthComputable?100*a.loaded/a.total:0),c=99>=b?"uploading":"processing";g.notify({status:c,total:a.total,loaded:a.loaded})}:(d.addEventListener("loadstart",function(a){a&&g.notify({status:"uploading",total:a.total,loaded:a.loaded})},!1),d.addEventListener("loadend",function(a){a&&g.notify({status:"processing",total:a.total,loaded:a.loaded})},!1)),g.cancellable()["catch"](function(a){"aborted_by_user"===a.message&&d.abort()}),e(),g},j=function(a){return{status:a.status,statusText:a.statusText,data:k(a.responseText)}},k=function(a){return"string"==typeof a&&(a=["{","["].indexOf(a[0])>=0?JSON.parse(a):{message:a}),a},i=function(a,b){if(!b)return a;var c=[];return Object.keys(b).forEach(function(a){var d=b[a];null!==d&&"undefined"!=typeof d&&(d instanceof Array||(d=[d]),d.forEach(function(b){b instanceof Date&&!isNaN(b.valueOf())?b=b.toISOString():"object"==typeof b&&(b=JSON.stringify(b)),c.push(h(a)+"="+h(b))}))}),c.length>0&&(a+=(-1===a.indexOf("?")?"?":"&")+c.join("&")),a},h=function(a){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")},g=function(a,c,d){var e=new XMLHttpRequest;return d.cache===!1&&(c+=(-1===c.indexOf("?")?"?":"&")+"_="+Date.now()),e.open(a.toUpperCase(),b.normalizeUri(c)),e.responseType=d.responseType,e.withCredentials=d.withCredentials,Object.keys(d.headers).forEach(function(a){e.setRequestHeader(a,d.headers[a])}),e},e=function(a,c,d){var e=g("get",i(a,c),b.extend({},m,d));return l(e,function(){e.send(null)})},d=function(a,c,d){var e=g("post",a,b.extend({},m,{headers:{"Content-Type":"application/json;charset=UTF-8"}},d));return l(e,function(){c&&"object"==typeof c&&c instanceof FormData==!1&&(c=JSON.stringify(c)),e.send(c)})},f=function(a,c,d){var e,f=g("post",a,b.extend({},m,d));return e=new FormData,Object.keys(c).forEach(function(a){var b=c[a],d="file"===a?[a,b,b.name]:[a,b];return e.append.apply(e,d)}),l(f,function(){f.send(e)},!0)},{get:e,post:d,upload:f}}(b,c,d),f=function(a){function b(){}function c(a,b){a.forEach(function(a){a(b)})}function d(a,b,c){a.forEach(function(a){a[b](c)})}function e(c,e,f){if("undefined"==typeof i[e])return{resolveAt:b,rejectAt:b};var g=[],h=[];return i[e].forEach(function(b){var c=[],d=[],e=f.promises.map(function(){return new a(function(a,b){c.push(a),d.push(b)})});g.push(c),h.push(d),b(e,f)}),{resolveAt:function(a,b){d(g,a,b)},rejectAt:function(a,b){d(h,a,b)}}}function f(d,f,g){if("object"!=typeof d||null===d)throw new Error("target should be a function");if("string"!=typeof f)throw new Error("eventName should be a string");if(g=g||{},g.eventTarget=d,g.eventName=f,g.promises&&g.promises.length)return e(d,f,g);if("undefined"==typeof i[f])return{resolve:b,reject:b};var h=[],j=[];return i[f].forEach(function(b){var c=new a(function(a,b){h.push(a),j.push(b)});b(c,g)}),{resolve:function(a){c(h,a)},reject:function(a){c(j,a)}}}function g(a,b){"undefined"==typeof i[a]&&(i[a]=[]),i[a].push(b)}function h(a,b){if(i[a]){var c=i[a].indexOf(b);i[a].splice(c,1)}}var i={};return{emit:f,addListener:g,removeListener:h}}(b),g=function(a,b){return function(c,d){if("function"!=typeof c)throw new Error("Source constructor should be a function");if("undefined"!=typeof d&&("object"!=typeof d||null===d))throw new Error("Source settings should be an object");return new c(d,b.emit,a)}}(e,f),h=function(a){return{id:a.folder_id,name:a.folder_name,mediaType:a.media_type,filesCount:a.files_count,createdAt:a.created_ts}},i=function(a){return function(b){return 403===b.status&&"Missing Wix session"===b.data.error_description&&(b.status=401,b.data.message="Wix Session required"),a.reject(b)}}(b),j=function(a,b,c){return function(d){function e(a){return c(a)}function f(c,f){return f=f||{},a.get(d.apiUrl+"/folders",{media_type:f.mediaType||"picture",folder_id:c||null},{withCredentials:!0}).then(function(a){return{data:a.data.folders.map(b)}},e)}function g(b){return a.post(d.apiUrl+"/folders/"+b+"/delete",null,{withCredentials:!0}).then(function(){return b},e)}function h(a){return a.map(g)}return{list:f,remove:h}}}(e,h,i),k=function(a){return"object"!=typeof a||null===a?{valid:!1,message:"Please specify new props"}:"undefined"==typeof a.name||a.name?"undefined"==typeof a.folderId||a.folderId?{valid:!0}:{valid:!1,message:"Please specify folder id"}:{valid:!1,message:"Please specify name"}},l=function(a,b,c,d,e,f){return function(g){function h(a){return e(a)}function i(c,e){return c?(e=e||{},a.post(g.apiUrl+"/folders",{folder_name:c,media_type:e.mediaType||"picture"},{withCredentials:!0}).then(function(a){return a.data=d(a.data),a},h)):h(b.toError({status:-200,statusText:"Internal JS Error",data:{message:"Please specify name"}}))}function j(d,e){var i=f(e);return i.valid===!1?h(b.toError({status:-200,statusText:"Internal JS Error",data:{message:i.message}})):a.post(g.apiUrl+"/folders/"+d.id+"/put",{folder_name:e.name},{withCredentials:!0}).then(function(a){return a.data=c.merge(d,e),a},h)}return{create:i,update:j}}}(e,d,c,h,i,k),m=function(a,b){var c,d,e,f=b.normalizeUri;return c=function(a,b){return"rembrandt"===b.imageOperationsApi?d.apply(this,arguments):e.apply(this,arguments)},d=function(a,b){function c(a){return a.replace(e,"")}function d(a){return e.exec(a)[1]}var e=/([^\/]+)$/;switch(a.media_type){case"picture":case"site_icon":return{thumbnail:f(b.filesUrl+"/"+c(a.file_url)+"/v1/#mode#/w_#width#,h_#height#/"+d(a.file_url)),original:f(b.filesUrl+"/"+c(a.file_url)+"/"+d(a.file_url))};case"document":return{thumbnail:f(b.filesUrl+"/"+a.icon_url),original:f(b.filesUrl+"/"+a.file_url)};case"music":case"secure_music":return{thumbnail:"./images/music-preview.png",original:f(b.filesUrl+"/"+a.file_url)};case"video":return{thumbnail:a.icon_url?f(b.filesUrl+"/"+a.icon_url):"./images/video-preview.png",original:f(b.filesUrl+"/"+a.file_url)};case"ufonts":return{thumbnail:f(b.filesUrl+"/"+a.icon_url),preview:f(b.filesUrl+"/media"+a.file_name.replace(/\..*/,"")+"_prvw.jpg"),original:f(b.filesUrl+"/"+a.file_url)};case"swf":return{thumbnail:f((b.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),original:f(b.filesUrl+"/"+a.file_url)};case"watermark":return{thumbnail:f(b.filesUrl+"/"+a.icon_url),original:f(b.filesUrl+"/"+a.file_url)};default:return{thumbnail:f(b.filesUrl+"/"+a.icon_url),original:f(b.filesUrl+"/"+a.file_url)}}},e=function(a,b){switch(a.media_type){case"picture":case"site_icon":return{thumbnail:f(b.filesUrl+"/"+a.file_url+"_#mode#_#width#_#height#_75_22_0.5_1.20_0.00_jpg_#mode#"),original:f(b.filesUrl+"/"+a.file_url)};case"document":case"music":case"secure_music":return{thumbnail:f(b.filesUrl+"/"+a.icon_url),original:f(b.filesUrl+"/"+a.file_url)};case"ufonts":return{thumbnail:f(b.filesUrl+"/"+a.icon_url),preview:f(b.filesUrl+"/media"+a.file_name.replace(/\..*/,"")+"_prvw.jpg"),original:f(b.filesUrl+"/"+a.file_url)};case"swf":return{thumbnail:f((b.staticFiles||"http://static.wix.com")+"/services/web/2.690.2/images/web/flash_swf_icon.png"),original:f(b.filesUrl+"/"+a.file_url)};case"watermark":return{thumbnail:f(b.filesUrl+"/"+a.icon_url),original:f(b.filesUrl+"/"+a.file_url)};default:return{thumbnail:f(b.filesUrl+"/"+a.icon_url),original:f(b.filesUrl+"/"+a.file_url)}}},function(d,e,g){function h(a){return Object.keys(g).reduce(function(c,d){var f=d+"Url",h=b.extend({},g[d]),i=a[d]||a.thumbnail;return"vangogh"===e.imageOperationsApi&&(h.mode=b.transformModeToVangogh(h.mode)),c[f]=b.insertDataInTemplate(i,h),c},{})}var i={id:d.file_name,folderId:d.parent_folder_id||null,name:d.original_file_name,mediaType:d.media_type,fileUrl:f(d.file_url),createdAt:d.created_ts,tags:b.splitTags(d.tags),width:d.width||null,height:d.height||null,fileInfo:a.toObject(d.file_info),fileInput:a.toObject(d.file_input),fileOutput:a.toObject(d.file_output)};return g=b.extend(e.thumbnailSizes,g),i=b.extend(i,h(c(d,e)))}}(d,c),n=function(a,b,c,d,e){return function(a){function f(a){return e(a)}function g(b,c){return b.data.files?b.data.files.map(function(b){return d(b,a,c)}):[]}function h(d,e){e=e||{};var h=c.extend(m,e.sort),i=c.extend(l,e.paging),j={page_size:i.size,cursor:i.cursor,parent_folder_id:d,media_type:e.mediaType};return j.order="desc"===h.direction?"-"+h.order:h.order,b.get(a.apiUrl+"/files/getpage",j,{withCredentials:!0}).then(function(a){return{data:g(a,e.thumbnails),paging:{size:i.size,cursor:a.data.cursor}}})["catch"](f)}function i(c){return b.post(a.apiUrl+"/files/"+c+"/delete",null,{withCredentials:!0}).then(function(){return c})["catch"](f)}function j(a){return a.map(i)}function k(d,e){e=e||{};var h=c.extend(m,e.sort),i=c.extend(l,e.paging),j={page_size:i.size,cursor:i.cursor,media_type:e.mediaType,order:"desc"===h.direction?"-"+h.order:h.order};return b.get(a.apiUrl+"/files/get?tag="+d,j,{withCredentials:!0,cache:!1}).then(function(a){return{data:g(a),paging:{size:i.size,cursor:a.data.cursor}}})["catch"](f)}var l={size:50,cursor:null},m={order:"date",direction:"desc"};return{list:h,remove:j,searchByTag:k}}}(b,e,c,m,i),o=function(a,b,c,d,e,f,g){return function(h){function i(a){return h.uploadLimits[c.snakeToCamel(a)]}function j(a){return a.file.size>=i(a.mediaType)}function k(a){"function"==typeof a&&r.push(a)}function l(a){return e(a)}function m(a){function c(a){return"secure_music"===a?"music-goods/upload":"video"===a?"video/upload":"upload"}return b.get(h.apiUrl+"/files/"+c(a.mediaType)+"/url",{media_type:a.mediaType,file_name:a.name,file_size:a.size,content_type:a.file.type},{withCredentials:!0})}function n(a){var e={url:encodeURIComponent(c.normalizeUri(a.url)),media_type:a.mediaType,name:a.name||"Untitled",tags:(a.tags||[]).join(",")||null,parent_folder_id:a.folderId||null},f=h.apiUrl+"/files/upload/external?url="+e.url+"&media_type="+e.media_type,g=b.post(f,e,{withCredentials:!0}).progress(function(a){g.notify(a)}).then(function(a){return d(a.data,h)});return g}function o(e){var f={parent_folder_id:e.folderId||null,file:e.file,media_type:e.mediaType};if(j(e))return a.reject(g.toError({status:-406,statusText:"Not Acceptable",data:{error_description:"File size is bigger than "+c.bytesToSize(i(e.mediaType))}}));var k=m(e).then(function(a){return b.upload(a.data.upload_url,f,{withCredentials:!0}).progress(function(a){k.notify(a)})}).then(function(a){return d(a.data[0],h)});return k}function p(a){return b.get(h.apiUrl+"/files/"+a,null,{withCredentials:!0,cache:!1}).then(function(a){return d(a.data,h)},l)}function q(a,d){var e=f(d);if(e.valid===!1)return l(g.toError({status:-200,statusText:"Internal JS Error",data:{message:e.message}}));d.tags=d.tags||a.tags||[];var i=d.tags.join(",");return b.post(h.apiUrl+"/files/"+a.id+"/put",{original_file_name:d.name,parent_folder_id:d.folderId,tags:i},{withCredentials:!0}).then(function(b){return b.data=c.merge(a,d),b},l)}var r=[];return{onItemUploadProgress:k,upload:o,uploadByUrl:n,get:p,update:q}}}(b,e,c,m,i,k,d),p={apiUrl:"http://files.wix.com",imageOperationsApi:"vangogh",filesUrl:"http://static.wixstatic.com",uploadLimits:{"default":15728640,document:15728640,picture:15728640,music:52428800,video:524288e3,secureMusic:157286400},thumbnailSizes:{thumbnail:{width:210,height:210,mode:"fill"},preview:{width:375,height:375,mode:"fit"},original:{width:1e3,height:1e3,mode:"fit"}}},q=function(a,b,c){return{addEvents:function(d,e,f){var g={};return Object.keys(e).forEach(function(h){var i=c.snakeToCamel(h.toLowerCase());"function"==typeof f[i]&&(g[i]=function(){var c,g,j=arguments,k=f[i].apply(f,j),l={arguments:j};return Array.isArray(k)?(l.promises=k,c=b.emit(d,e[h],l),k.forEach(function(a,b){var d=a.then(function(a){c.resolveAt(b,a)},function(a){c.rejectAt(b,a)});a.progress(function(a){d.notify(a)})}),k):(c=b.emit(d,e[h],l),g=k.then(function(a){return c.resolve(a),a},function(b){return c.reject(b),a.reject(b)}),k.progress(function(a){g.notify(a)}),g)})}),g}}}(b,f,c),r={FOLDERS:{LIST:"folders.list",REMOVE:"folders.remove"},FOLDER:{CREATE:"folder.create",UPDATE:"folder.update",REMOVE:"folder.remove"},ITEMS:{LIST:"items.list",SEARCH:"items.search",REMOVE:"items.remove",UPLOAD:"items.upload",UPLOAD_BY_URL:"items.uploadByUrl",SEARCH_BY_TAG:"items.searchByTag"},ITEM:{GET:"item.get",UPDATE:"item.update",REMOVE:"item.remove",UPLOAD:"item.upload",UPLOAD_BY_URL:"item.uploadByUrl"}},s=function(a,b,c,d,e,f,g,h){return function(i){var j=f.extend({},e,i),k=a(j),l=b(j),m=c(j),n=d(j);this.name="private",this.folders=g.addEvents(this,h.FOLDERS,k),this.folder=g.addEvents(this,h.FOLDER,l),this.item=g.addEvents(this,h.ITEM,n),this.items=g.addEvents(this,h.ITEMS,m)}}(j,l,n,o,p,c,q,r),t={apiUrl:"http://pix-test.wix.com/services/google"},u=function(a){return{id:a.gphoto$id.$t,name:a.title.$t,mediaType:"picture",parentId:null,filesCount:a.gphoto$numphotos.$t,createdAt:a.published.$t}},v=function(a){return function(b){return{data:b.feed.entry.map(a)}}}(u),w=function(a){return function(b){return a.reject(b)}}(b),x=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/albums",{thumbsize:"150c","max-results":500},{withCredentials:!0}).then(e)["catch"](f)}return{list:g}}}(e,v,w),y=function(a){function b(a){var b=a.media$thumbnail.filter(function(a){return!a.medium||"video"!==a.medium});return b[b.length-1].url||""}return function(c){var d,e,f,g,h;return d=b(c.media$group),e=+c.gphoto$width.$t||1024,f=+c.gphoto$height.$t||768,g=d.replace(/\/s[0-9]+/,"/w"+e+"-h"+f+"-no"),h=e>400?d.replace(/\/s[0-9]+(-c)?/,"/s400"):g,{id:c.id.$t,name:c.summary.$t||c.title.$t,mediaType:"picture",fileUrl:a.normalizeUri(g),thumbnailUrl:a.normalizeUri(d),previewUrl:a.normalizeUri(h),createdAt:c.published.$t,tags:[],width:e,height:f}}}(c),z=function(a){return function(b){return{data:b.feed.entry.map(a),paging:{cursor:b.feed.openSearch$startIndex.$t+b.feed.openSearch$itemsPerPage.$t,pageSize:b.feed.openSearch$itemsPerPage.$t}}}}(y),A=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={album_id:b||null,kind:"photo",thumbsize:"150c","max-results":c.paging.pageSize||50,"start-index":c.paging.cursor||1};return a.get(d.apiUrl+"/photos",g,{withCredentials:!0}).then(e,f)}return{list:g}}}(e,z,w),B=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g),this.name="picasa"}}(t,x,A,q,r),C={apiUrl:"http://pix-test.wix.com/services/instagram",api2Url:"http://pix-test.wix.com/services/instagram2"},D=function(a){return{id:"Instagram",name:"Instagram",mediaType:"picture",parentId:null,filesCount:a.counts.media,createdAt:null}},E=function(a){return function(b){return{data:[a(b)]}}}(D),F=function(a){return function(b){return 500===b.code&&(b.code=403,b.data={message:"Unauthorized",result:"error"}),a.reject(b)}}(b),G=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/user",null,{withCredentials:!0}).then(e,f)}return{list:g}}}(e,E,F),H=function(a){return function(b){return b.caption||(b.caption={text:""}),{id:b.id,name:b.caption.text,mediaType:"picture",fileUrl:a.normalizeUri(b.images.standard_resolution.url),thumbnailUrl:a.normalizeUri(b.images.low_resolution.url),previewUrl:a.normalizeUri(b.images.standard_resolution.url),createdAt:1e3*+b.created_time,tags:a.splitTags(b.tags),width:b.images.standard_resolution.width,height:b.images.standard_resolution.height}}}(c),I=function(a){return function(b){b.next=b.next||{};var c=b.next.max_id||null,d=b.next.count||null;return{data:b.photos.map(a),paging:{cursor:c,pageSize:d}}}}(H),J=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={count:c.paging.pageSize||50,max_id:c.paging.cursor||null};return a.get(d.api2Url+"/photos",g,{withCredentials:!0}).then(e,f)}return{list:g}}}(e,I,F),K=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.name="instagram",this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g)}}(C,G,J,q,r),L={apiUrl:"http://pix-test.wix.com/services/facebook2"},M=function(a){return{id:a.id,name:a.name,mediaType:"picture",parentId:null,filesCount:a.count,createdAt:a.created_time}},N=function(a){return function(b){return{data:b.data.map(a)}}}(M),O=function(a){return function(b){return 400===b.code&&190===b.data.code&&(b.code=403),a.reject(b)}}(b),Q=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/albums",null,{withCredentials:!0}).then(e,f)}return{list:g}}}(e,N,O),R=function(a){function b(b,c,d){d=d||190,c=c||190;var e,f,g;return 1===b.length?b[0].source:(e=b.filter(function(a){return a.width>c&&a.height>d}),(g=a.min(e,function(a){return a.width+a.height}))?g.source:(f=a.max(b,function(a){return a.width+a.height}),f.source))}return function(c){return{id:c.id,folderId:null,name:c.name||"",mediaType:"picture",fileUrl:a.normalizeUri(c.source),thumbnailUrl:a.normalizeUri(b(c.images)),previewUrl:a.normalizeUri(c.source),createdAt:c.created_time,tags:[],width:c.width,height:c.height}}}(c),S=function(a){return function(b){return b.paging=b.paging||{},b.paging.cursors=b.paging.cursors||{},b.paging.cursors.after=b.paging.cursors.after||null,{data:b.data.map(a),paging:{cursor:b.paging.cursors.after,pageSize:null}}}}(R),T=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={album_id:b,limit:c.paging.pageSize||50,after:c.paging.cursor||null};return a.get(d.apiUrl+"/photos",g,{withCredentials:!0}).then(e,f)}return{list:g}}}(e,S,O),U=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.name="facebook",this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g)}}(L,Q,T,q,r),V={apiUrl:"http://pix-test.wix.com/services/flickr"},W=function(a){return{id:a.id,name:a.title._content,mediaType:"picture",parentId:null,filesCount:+a.photos+ +a.videos,createdAt:1e3*+a.date_create}},X=function(a){return function(b){return{data:b.photosets.photoset.map(a)}}}(W),Y=function(a){return function(b){return a.reject(b)}}(b),Z=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(){return a.get(d.apiUrl+"/albums",{primary_photo_extras:"url_t,url_s,url_m,url_b,url_o"},{withCredentials:!0}).then(e,f)}return{list:g}}}(e,X,Y),$=function(a){function b(a){var b=a.url_m||a.url_s||a.url_t,c=a.url_b||b,d=a.url_o||c;return{fileUrl:d,thumbnailUrl:b,previewUrl:c}}return function(c){var d=b(c);return{id:c.id,name:c.title,folderId:null,mediaType:"picture",fileUrl:a.normalizeUri(d.fileUrl),thumbnailUrl:a.normalizeUri(d.thumbnailUrl),previewUrl:a.normalizeUri(d.previewUrl),createdAt:null,tags:[],width:+(c.width_o||c.width_m||c.width_s||c.width_t),height:+(c.height_o||c.height_m||c.height_s||c.height_t)}}}(c),_=function(a){return function(b){var c=b.photoset.page<b.photoset.pages?b.photoset.page+1:null,d=+b.photoset.perpage;return{data:b.photoset.photo.map(a),paging:{cursor:c,pageSize:d}}}}($),ab=function(a,b,c){return function(d){function e(a){return b(a.data)}function f(a){return c(a)}function g(b,c){c=c||{},c.paging=c.paging||{};var g={extras:"url_t,url_s,url_m,url_b,url_o",set_id:b,per_page:c.paging.pageSize||50,page:c.paging.cursor||null};return a.get(d.apiUrl+"/photoset",g,{withCredentials:!0}).then(e)["catch"](f)}return{list:g}}}(e,_,Y),bb=function(a,b,c,d,e){return function(){var f=b(a),g=c(a);this.name="flickr",this.folders=d.addEvents(this,e.FOLDERS,f),this.items=d.addEvents(this,e.ITEMS,g)}}(V,Z,ab,q,r),cb=function(a,b,c,d,e){return{PRIVATE:a,PICASA:b,INSTAGRAM:c,FACEBOOK:d,FLICKR:e}}(s,B,K,U,bb),db=function(a,b,c){function d(a,b){Object.defineProperty(e,a,{enumerable:!1,value:b})}var e={};return e=c.merge(b),d("on",a.addListener),d("off",a.removeListener),e}(f,r,c),eb={PICASA:{connectUrl:"http://pix-test.wix.com/services/google/connect",disconnectUrl:"http://pix-test.wix.com/services/google/disconnect",parameterName:"goglact"},INSTAGRAM:{connectUrl:"http://pix-test.wix.com/services/instagram/connect",disconnectUrl:"http://pix-test.wix.com/services/instagram/disconnect",parameterName:"instact"},FACEBOOK:{connectUrl:"http://pix-test.wix.com/services/facebook/connect",disconnectUrl:"http://pix-test.wix.com/services/facebook/disconnect",parameterName:"fbact"},FLICKR:{connectUrl:"http://pix-test.wix.com/services/flickr/connect",disconnectUrl:"http://pix-test.wix.com/services/flickr/disconnect",parameterName:"flact"}},fb=function(a,b,c,d){return function(e,f){function g(){return k.parameterName}function h(){return!!localStorage.getItem(k.parameterName)}function i(){return localStorage.removeItem(k.parameterName),c.get(k.disconnectUrl,null,{withCredentials:!0})}function j(){var b;return window.open(k.connectUrl+"?return_url="+f.redirectUrl,"connector","width=950,height=550"),b=new a(function(a,b){window.connectService=function(c){var e,f;e=d.getParameterByName(c,g()),f=d.getParameterByName(c,"status"),!e||f&&"FAIL"===f?b("Not Authorized"):a(e)}}),b.then(function(a){localStorage.setItem(k.parameterName,a)},function(a){return a}),b}var k=b[e];if("object"!=typeof k)throw new Error("Invalid source");return{isConnected:h,disconnect:i,connect:j}}}(b,eb,e,c),gb={severity:{info:10,warning:20,error:30,fatal:40},BIEventsIds:{"folder.create":"112","folder.rename":"115","folder.remove":"117","item.remove":"118",responseTime:"125",searchItems:"126"},BIAdaptersIds:{"private":"01","public":"02",facebook:"03",flickr:"04",instagram:"05",picasa:"06",flickrSearch:"07",googleSearch:"08"},BIAdaptersRequestsIds:{"folders.list":"01","folder.create":"02","folder.rename":"03","folder.remove":"04","items.list":"11","item.upload":"12","item.uploadByUrl":"13","item.update":"14","item.remove":"15",moveItem:"16","items.search":"17",getMoreSearchedItems:"17",getItemsByTag:"18",transcodeItem:"19"}},hb=function(a,b){function c(a,c){var d=document.createElement("img");d.setAttribute("src",a+"?"+b.encodeParams(c)),d=null}function d(){return(new Date).getTime()}function e(){return"http://frog.wixpress.com"}function f(b){return c(e()+"/mg",{evid:a.BIEventsIds.responseTime,call_name:b.requestName||"",ts:b.responseTime||0,result:b.isSuccess?"success":"fail",response_speed:Math.floor(b.responseSize||0/(b.responseTime/1e3)),response_size:b.responseSize})}function g(a,b,c){var e=a.name+"("+b+")",g=d()-c.startedAt;f({requestName:e,responseTime:g,isSuccess:c.isSuccess,responseSize:c.responseSize})}function h(a,b){var c=d();a.then(function(){g(b.eventTarget,b.eventName,{startedAt:c,responseSize:0,isSuccess:!0})})["catch"](function(){g(b.eventTarget,b.eventName,{startedAt:c,responseSize:0,isSuccess:!1})})}function i(a,b){return b.evid=a,c(e()+"/mg",b)}function j(b,d,f){var g=f.code||"000",h=a.BIAdaptersIds[b]||"00",i=a.BIAdaptersRequestsIds[d]||"00",j=b+" "+d+": "+f.message,k=h+i+g;return c(e()+"/trg",{src:25,evid:10,iss:1,sev:a.severity.error,errc:k||"0000000",ver:"MEDIA_GALLERY_VERSION",site_id:"",httpc:g||"000",dsc:j||""})}return{report:i,error:j,benchmark:h}}(gb,c),ib=function(a,b,c){return function(d){var e=function(a,b){c.benchmark(a,b);var d=function(a,b,d){c.error(a.name,b,d)},e=function(){},f=function(a){d(b.eventTarget,b.eventName,a)};return a.then(e,f)};Object.keys(b).forEach(function(c){Object.keys(b[c]).forEach(function(f){d===!0?a.addListener(b[c][f],e):a.removeListener(b[c][f],e)})})}}(f,r,hb),jb=function(a){function b(a){return"waiting"===a.status||"uploading"===a.status}function c(a){a.status="failed",a.deferred.promise["catch"](function(b){a.error=b}),a.deferred.promise.abort()}function d(a,b){a.status="uploading",a.uploadPromise=b.uploadFn(a.source).progress(function(b){a.deferred.promise.notify(b)}).then(function(b){a.deferred.resolve(b)})["catch"](function(b){a.error=b,a.deferred.reject(b)})}function e(){var b=a.defer();return b.promise["catch"](function(a){console.log(a)}),b.promise.cancellable(),b}function f(a){return{source:a.source,status:"waiting",bytesLoaded:0,deferred:e(),isAborted:!1,error:{},upload:function(){return this.isAborted||d(this,a),this.deferred.promise},abort:function(){if(b(this)){if(this.isAborted=!0,"waiting"===this.status)return void c(this);this.status="failed",this.uploadPromise.abort()}},canRetry:function(){if(!this.error.code)return!1;var a=[-100,-201,-406];return"failed"===this.status&&-1!==a.indexOf(this.error.code)?!0:!1},signUpForRetry:function(){this.status="waiting",this.isAborted=!1,this.error={},this.deferred=e()},canAbort:function(){return b(this)}}}return f}(b),kb=function(a,b){function c(a){return function(b){return b.name===a}}function d(a,b){"string"==typeof a&&(a=[a]),a.forEach(function(a){if(!w.indexOf(a))throw new Error("This event"+a+"is not supported by multiple file uploader");x.push({name:a,fn:b})})}function e(a,b){var d=[].slice;b=arguments.length>=2?d.call(arguments,1):[],x.filter(c(a)).forEach(function(c){c.fn.apply({event:a},b)})}function f(){return 0!==r.filter(function(a){return"waiting"===a.status}).length}function g(){return r.some(function(a){return a.canRetry()})}function h(a,b){var c=a[u];return c&&"waiting"!==c.status?(u++,h(a,b),t.promise):c||f()?!c&&f()?(u=0,h(a,b),t.promise):(b(c)["finally"](function(){u++,h(a,b)}),t.promise):(s=!1,u=0,t.resolve(),t.promise)}function i(a){return a.source.file?a.source.file.size:1}function j(){return r.reduce(function(a,b){return a+i(b)},0)}function k(a,b){switch(b.status){case"uploading":return b.loaded<=i(a)?b.loaded:i(a);case"succeeded":case"processing":return i(a);case"failed":return 0;default:return 0}}function l(a){return function(b){a.status=b.status,a.bytesLoaded=b.loaded,b.file=a,e("fileStatusChanged",{bytesUploaded:v+k(a,b),bytesTotal:j(),currentFileProgress:b,currentFileQueueIdx:u})}}function m(a){return a.upload()}function n(a){var b=l(a);a.deferred.promise.progress(b).then(function(){b({status:"succeeded",total:i(a),loaded:i(a)}),v+=i(a)})["catch"](function(){b({status:"failed",total:i(a),loaded:0})})}function o(){e("uploadQueueStarted",r),h(r,m)["finally"](function(){e("uploadQueueFinished",r)})}function p(){if(s)throw new Error("Upload queue can not be cleared while upload is running");r.length=0,v=0}function q(c){c=c||[],s||g()||(p(),t=a.defer());var d=c.map(b);return d.forEach(function(a){n(a);var b=a.signUpForRetry;a.signUpForRetry=function(){b.apply(this,arguments),n(a),s||(s=!0,o())},r.push(a)}),e("queueChange",r),s||(s=!0,o()),d}var r=[],s=!1,t=a.defer(),u=0,v=0,w=["queueChanged","fileStatusChanged","uploadQueueStarted","uploadQueueFinished"],x=[];return{on:d,upload:q,clearQueue:p}}(b,jb),lb=function(a,b,c,d,e,f){return{Source:a,sources:b,events:c,bi:e,connectExternalSource:d,Uploader:f}}(g,cb,db,fb,ib,kb),window.wixmp=lb}();